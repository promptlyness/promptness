<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Promptly Manages AI Prompts for Text, Image, Video, Audio & Code.">
	<meta name="theme-color" content="#38bdf8">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="default">
	<meta name="mobile-web-app-capable" content="yes">
	<meta name="msapplication-TileImage" content="icon192x192.png">
    <link rel="manifest" href="manifest.json">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png">
	<link rel="apple-touch-icon" sizes="192x192" href="icon192x192.png">
	<title>Promptness Pro</title>
	<script>window.PRO_PUBLIC_KEY='04502916d26965823ce66cbe809890a9541cf82c60723983aff3a03e368c8f2a645f09d57655a0d674465d2525c5d25abbff6bfc064f03980a00aa1c6268310082'</script>
    <style>
        :root {
            --bg: #020617;
            --panel: #020617;
            --border: #1f2937;
            --accent: #38bdf8;
            --accent2: #a855f7;
            --accent-soft: rgba(56,189,248,0.18);
            --accent-glow: 0 0 16px rgba(56,189,248,0.55);
            --text: #e5e7eb;
            --muted: #9ca3af;
            --muted-dark: #6b7280;
            --danger: #f87171;
        }

		.install-tip-wrap {
		  width: 100%;
		  text-align: center;
		}
		
		.install-tip {
		  margin-top: 0.25rem;
		  font-size: 0.78rem;
		  color: var(--muted);
		  background: rgba(56,189,248,0.08);
		  border-radius: 999px;
		  padding: 0.25rem 0.6rem;
		  display: inline-block;
		}

		/* Utility: hide in PWA display modes */
		.hide-in-pwa {
		  display: inline-block;
		}

		@media (display-mode: standalone), (display-mode: minimal-ui) {
		  .hide-in-pwa {
			display: none !important;
		  }
		}

        * { box-sizing: border-box; }

        body {
            margin: 0;
            padding: 1.25rem;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: radial-gradient(circle at top, rgba(56,189,248,0.16) 0%, transparent 50%), 
                        radial-gradient(circle at bottom, rgba(168,85,247,0.10) 0%, #020617 55%);
            color: var(--text);
        }

        .app {
            max-width: 1120px;
            margin: 0 auto;
            background: radial-gradient(circle at top left, rgba(56,189,248,0.10), transparent 55%), 
                        radial-gradient(circle at bottom right, rgba(168,85,247,0.10), transparent 55%), 
                        var(--panel);
            border-radius: 18px;
            border: 1px solid rgba(56,189,248,0.6);
            box-shadow: var(--accent-glow), 0 26px 60px rgba(0,0,0,0.78);
            padding: 1.4rem 1.4rem 1.1rem;
            position: relative;
        }

        .app::before, .app::after {
            content: '';
            position: absolute;
            width: 90px;
            height: 90px;
            border-radius: 26px;
            border: 1px solid rgba(56,189,248,0.6);
            pointer-events: none;
            opacity: 0.35;
        }

        .app::before { top: -10px; left: -14px; border-color: rgba(56,189,248,0.75); box-shadow: 0 0 18px rgba(56,189,248,0.8); }
        .app::after { bottom: -10px; right: -14px; border-color: rgba(168,85,247,0.75); box-shadow: 0 0 18px rgba(168,85,247,0.8); }

        .app-header { display: flex; justify-content: space-between; gap: 1rem; align-items: flex-start; margin-bottom: 0.75rem; flex-wrap: wrap; position: relative; z-index: 1; }
        .app-title { flex: 1 1 auto; min-width: 220px; display: flex; align-items: flex-start; gap: 0.5rem; }
        .app-title-main { flex: 1 1 auto; min-width: 0; }
        .app-title-actions { flex: 0 0 auto; display: flex; align-items: flex-start; justify-content: flex-end; }

        .app-title h1 { font-size: 1.45rem; margin: 0 0 0.2rem; }
        .app-title p { margin: 0; color: var(--muted); font-size: 0.9rem; }

        .help-link {
            font-size: 0.8rem; color: var(--accent); text-decoration: none; display: inline-flex; align-items: center; justify-content: center;
            gap: 0.3rem; cursor: pointer; width: 32px; height: 32px; border-radius: 999px; background: rgba(15,23,42,0.9);
            border: 1px solid rgba(56,189,248,0.9); box-shadow: 0 0 12px rgba(56,189,248,0.7);
        }
        .help-link span { font-size: 1rem; line-height: 1; }

        .pro-bar {
            margin: 0.1rem 0 0.55rem; border-radius: 12px; border: 1px solid rgba(56,189,248,0.6);
            background: radial-gradient(circle at left, rgba(56,189,248,0.18), rgba(15,23,42,0.96)); padding: 0.5rem 0.8rem;
			text-align: center;/* centers text inside */
        }
		
        .pro-text { font-size: 0.78rem; color: var(--muted); max-width: 100%;}
        .pro-highlight { color: #38bdf8; font-weight: 600; }

        .tabs { margin-top: 0.2rem; position: relative; z-index: 5; }
        .tabs-sticky {
            position: sticky; top: 0; z-index: 10; background: linear-gradient(to bottom, rgba(2,6,23,0.98), rgba(2,6,23,0.95));
            padding-top: 0.15rem; margin: 0 -1.0rem 0.5rem; padding-left: 1.0rem; padding-right: 1.0rem;
        }
        .tab-list {
            display: flex; gap: 0.4rem; flex-wrap: wrap; border-bottom: 1px solid rgba(56,189,248,0.5);
            padding-bottom: 0.4rem; margin-bottom: 0.4rem; justify-content: center;
        }
        .tab-btn {
            border-radius: 999px; padding: 0.4rem 0.9rem; border: 1px solid rgba(148,163,184,0.5); background: rgba(15,23,42,0.9);
            color: var(--muted); font-size: 0.85rem; cursor: pointer; display: inline-flex; align-items: center; gap: 0.4rem;
            transition: background 0.15s ease, color 0.15s ease, border-color 0.15s ease, box-shadow 0.15s ease; box-shadow: 0 0 8px rgba(15,23,42,0.9);
            white-space: nowrap;
        }
        .tab-btn span.icon { font-size: 0.9rem; }
        .tab-btn-active {
            background: linear-gradient(135deg, rgba(56,189,248,0.26), rgba(168,85,247,0.26)); border-color: rgba(56,189,248,0.9);
            color: var(--text); box-shadow: 0 0 16px rgba(56,189,248,0.6);
        }
        .tab-btn:hover:not(.tab-btn-active) { background: rgba(15,23,42,0.96); border-color: rgba(148,163,184,0.9); }

        .tab-panels { margin-top: 0.4rem; }
        .tab-panel { display: none; animation: fadeIn 0.18s ease-out; }
        .tab-panel-active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: translateY(0); } }

        label { display: block; margin-bottom: 0.25rem; font-size: 0.8rem; color: var(--muted); }
        .field-desc { font-size: 0.75rem; color: var(--muted-dark); margin-bottom: 0.3rem; }
        .label-inline-row { display: flex; justify-content: space-between; align-items: baseline; gap: 0.5rem; flex-wrap: wrap; }
        .label-inline-row label { margin: 0; }
        .label-inline-row .field-desc { margin: 0; font-size: 0.76rem; }

        input[type="text"], textarea, select {
            width: 100%; border-radius: 9px; border: 1px solid rgba(30,64,175,0.6); background: rgba(15,23,42,0.92);
            padding: 0.55rem 0.7rem; color: var(--text); font-size: 0.9rem; margin-bottom: 0.65rem; outline: none;
            box-shadow: 0 0 10px rgba(15,23,42,0.9);
        }
        input:focus, textarea:focus, select:focus { border-color: var(--accent2); box-shadow: 0 0 0 1px rgba(168,85,247,0.45); }
   <!-- textarea { resize: vertical; min-height: 70px; } -->
        textarea {
			resize: none;          /*none or vertical hide native grabber */
			overflow: hidden;      /*hidden or auto prevent inner scrollbars */
			min-height: 70px;
		}
		.row { display: flex; gap: 0.7rem; flex-wrap: wrap; }
        .row > div { flex: 1 1 180px; }

        .button-row { display: flex; flex-direction: column; align-items: center; gap: 0.4rem; margin-top: 0.4rem; }
        .button-row-inline { display: flex; align-items: center; justify-content: flex-end; gap: 0.5rem; flex-wrap: wrap; margin-top: 0.2rem; }

        button.primary {
            background: linear-gradient(135deg, var(--accent), var(--accent2)); color: #020617; border-radius: 999px; border: none;
            padding: 0.5rem 1.3rem; font-size: 0.9rem; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center;
            gap: 0.35rem; box-shadow: 0 0 14px rgba(56,189,248,0.6); white-space: nowrap;
        }
        button.primary:active { transform: translateY(1px); }

        .hint { font-size: 0.75rem; color: var(--muted-dark); text-align: center; }

        .output-box {
            margin-top: 0.75rem; border-radius: 10px; border: 1px solid rgba(56,189,248,0.7);
            background: radial-gradient(circle at top, rgba(56,189,248,0.15), rgba(15,23,42,0.96)); padding: 0.9rem;
            position: relative; box-shadow: 0 0 18px rgba(56,189,248,0.45);
        }
        .output-label {
            font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--muted); margin-bottom: 0.4rem;
            display: flex; align-items: center; justify-content: space-between; gap: 0.5rem;
        }
        .output-textarea {
            width: 100%; border: none; background: transparent; min-height: 120px; resize: vertical; color: var(--text);
            font-family: Menlo, Monaco, Consolas, Liberation Mono, monospace; font-size: 0.83rem; outline: none; padding: 0;
        }

        .copy-btn {
            font-size: 0.75rem; border-radius: 999px; border: 1px solid rgba(148,163,184,0.8); background: rgba(15,23,42,0.95);
            padding: 0.25rem 0.75rem; color: var(--text); cursor: pointer; box-shadow: 0 0 10px rgba(15,23,42,0.95); white-space: nowrap;
        }

        .pill {
            display: inline-flex; align-items: center; gap: 0.3rem; border-radius: 999px; border: 1px solid rgba(148,163,184,0.9);
            padding: 0.2rem 0.6rem; font-size: 0.75rem; color: var(--muted); background: rgba(15,23,42,0.92); white-space: nowrap;
        }
        .pill span.icon { font-size: 0.9rem; }

        .footer { margin-top: 0.8rem; font-size: 0.72rem; color: var(--muted-dark); text-align: right; }

        .collections-box {
            margin-top: 0.75rem; border-radius: 12px; border: 1px solid rgba(148,163,184,0.7);
            background: radial-gradient(circle at top, rgba(56,189,248,0.08), rgba(15,23,42,0.98)); padding: 0.7rem 0.7rem 0.6rem;
            box-shadow: 0 0 16px rgba(15,23,42,0.95); font-size: 0.8rem;
        }
        .collections-header { display: flex; align-items: center; gap: 0.4rem; margin-bottom: 0.4rem; }
        .collections-header h3 { margin: 0; font-size: 0.86rem; color: var(--text); letter-spacing: 0.12em; text-transform: uppercase; }

        .collections-actions-row {
            display: flex; flex-wrap: wrap; gap: 0.35rem; margin-bottom: 0.5rem; align-items: center;
        }
        .collections-actions-row input { margin-bottom: 0; padding: 0.35rem 0.55rem; font-size: 0.78rem; flex: 1 1 200px; }
        .collections-buttons-group { display: flex; flex-wrap: wrap; gap: 0.35rem; flex: 0 0 auto; }

        .collections-btn {
            font-size: 0.74rem; border-radius: 999px; border: 1px solid rgba(148,163,184,0.8); background: rgba(15,23,42,0.98);
            color: var(--text); padding: 0.3rem 0.7rem; cursor: pointer; white-space: nowrap; flex: 0 0 auto;
        }
        .collections-btn-primary { border-color: rgba(56,189,248,0.9); color: #38bdf8; }

        .collections-list {
            max-height: 220px; overflow-y: auto; border-radius: 8px; border: 1px solid rgba(31,41,55,0.9);
            background: rgba(15,23,42,0.98); padding: 0.35rem;
        }
        .collections-empty { font-size: 0.78rem; color: var(--muted-dark); padding: 0.25rem 0.2rem; }

        .collection-item {
            display: flex; align-items: center; justify-content: space-between; gap: 0.35rem; padding: 0.25rem 0.3rem;
            border-radius: 6px; cursor: pointer; font-size: 0.78rem;
        }
        .collection-item:hover { background: rgba(15,23,42,0.9); }
        .collection-main { display: flex; flex-direction: column; gap: 0.05rem; min-width: 0; }
        .collection-title { color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .collection-meta { font-size: 0.68rem; color: var(--muted-dark); }

        .collection-buttons { display: flex; gap: 0.3rem; flex-shrink: 0; }
        .collection-small-btn {
            font-size: 0.68rem; border-radius: 999px; border: 1px solid rgba(148,163,184,0.7); background: rgba(15,23,42,0.98);
            color: var(--muted); padding: 0.2rem 0.45rem; cursor: pointer; white-space: nowrap;
        }
        .collection-small-btn-danger { border-color: rgba(248,113,113,0.9); color: #fecaca; }

        @media (max-width: 480px) {
            .tab-list { justify-content: center; }
            .tab-btn { padding: 0.35rem; }
			.tab-btn span.icon { display: inline-block; }
			.tab-btn span:not(.icon) {display: none; }	
            .collections-actions-row { flex-direction: column; align-items: stretch; }
            .collections-actions-row input { width: 100%; flex: 0 0 auto; }
            .collections-buttons-group { width: 100%; justify-content: space-between; }
            .collections-btn { flex: 1 1 auto; text-align: center; }
        }

        @media (max-width: 720px) {
            body { padding: 0.7rem; }
            .app { padding: 1rem 0.9rem 0.9rem; border-radius: 14px; }
            .app-title h1 { font-size: 1.25rem; }
            .button-row-inline { justify-content: flex-start; }
        }

        .help-overlay-backdrop {
            position: fixed; inset: 0; background: rgba(15,23,42,0.85); display: none; align-items: center; justify-content: center; z-index: 30;
        }
        .help-overlay-backdrop.active { display: flex; }
        .help-overlay {
            max-width: 720px; max-height: 90vh; width: 100%; border-radius: 14px; border: 1px solid rgba(56,189,248,0.7);
            background: #020617; padding: 1rem 1.1rem; box-shadow: 0 20px 60px rgba(0,0,0,0.85), 0 0 20px rgba(56,189,248,0.55);
            overflow: hidden; display: flex; flex-direction: column; gap: 0.4rem;
        }
        .help-header { display: flex; justify-content: space-between; align-items: center; gap: 0.5rem; margin-bottom: 0.4rem; }
        .help-header h2 { font-size: 1rem; margin: 0; }
        .help-close {
            border-radius: 999px; border: 1px solid rgba(148,163,184,0.8); background: rgba(15,23,42,0.95); color: var(--muted);
            font-size: 0.8rem; padding: 0.25rem 0.6rem; cursor: pointer;
        }
        .help-body { overflow-y: auto; padding-right: 0.3rem; font-size: 0.8rem; color: var(--muted); }
        .help-body h3 { font-size: 0.85rem; color: var(--text); margin: 0.5rem 0 0.2rem; }
        .help-tag {
            display: inline-block; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.12em; color: var(--muted-dark);
            margin-bottom: 0.25rem;
        }

        .import-input {
            display: none;
        }

		.auth-bar {
		  margin-top: 0.4rem;
		  margin-bottom: 0.6rem;
		  padding: 0.35rem 0.7rem;
		  border-radius: 999px;
		  border: 1px solid rgba(56,189,248,0.45);
		  background: radial-gradient(circle at left, rgba(56,189,248,0.16), rgba(15,23,42,0.96));
		  display: flex !important;
		  align-items: center !important;
		  justify-content: center !important;  /* üéØ PERFECT CENTER */
		  gap: 0.6rem;
		  flex-wrap: wrap;
		  text-align: center;
		}

		/* FLEX CONTAINER forces resize */
		#licenseForm.unlocked {
		  flex-wrap: nowrap !important;
		  gap: 0.4rem !important;
		  justify-content: center !important;
		  align-items: center !important;
		  padding: 0.4rem 0.8rem !important;
		  min-height: 42px !important;
		}

		/* üéØ CENTERED ELEMENTS */
		#unlockedForm {
		  display: flex !important;
		  align-items: center !important;
		  justify-content: center !important;  /* üéØ PERFECT CENTER */
		  gap: 0.4rem !important;
		  width: 100% !important;
		  flex-wrap: nowrap !important;
		}

		/* üéØ CENTERED PRO ELEMENTS */
		#proStatus {
		  min-width: auto !important;
		  white-space: nowrap !important;
		  font-size: 0.85rem !important;
		  font-weight: 600 !important;
		  padding: 0.3rem 0.6rem !important;
		  flex-shrink: 0 !important;  /* Don't shrink */
		}

		/* üîÑ AUTO-RESIZE currentLicenseInfo */
		#currentLicenseInfo {
		  font-size: 0.8rem !important;
		  white-space: nowrap !important;
		  padding: 0.25rem 0.5rem !important;
		  flex-shrink: 0 !important;
		  max-width: 180px !important;
		  min-width: 120px !important;  /* Minimum width */
		  width: auto !important;       /* Auto resize! */
		  overflow: hidden !important;
		  text-overflow: ellipsis !important;
		  transition: all 0.15s ease !important;
		}

		#proLogout {
		  font-size: 0.85rem !important;
		  padding: 0.3rem 0.7rem !important;
		  white-space: nowrap !important;
		  flex-shrink: 0 !important;
		  min-width: 70px !important;
		}

		/* ‚õî BULLETPROOF KEYBOARD LOCK */
		.auth-locked .app {
		  opacity: 0.3 !important;
		  pointer-events: none !important;
		}

		/* BLOCK ALL INTERACTIVES */
		.auth-locked button:not(#proValidate):not(#proEmail):not(#proLicense):not(#proSignature),
		.auth-locked input:not(#proEmail):not(#proLicense):not(#proSignature),
		.auth-locked textarea:not(#proSignature),
		.auth-locked select,
		.auth-locked .tab-btn,
		.auth-locked .collections-btn,
		.auth-locked .copy-btn,
		.auth-locked label {
		  pointer-events: none !important;
		  tabindex: -1 !important;
		  outline: none !important;
		}

		/* KEYBOARD TRAP - ONLY LICENSE FORM */
		.auth-locked *:not(#licenseForm *) {
		  tabindex: -1 !important;
		}

		.auth-locked #licenseForm *,
		.auth-locked #proEmail,
		.auth-locked #proLicense,
		.auth-locked #proSignature,
		.auth-locked #proValidate {
		  tabindex: 0 !important;
		  pointer-events: auto !important;
		}
		.auth-locked #licenseForm {
		  opacity: 1!important;
		  pointer-events: auto!important;
		  background: linear-gradient(135deg, rgba(56,189,248,0.25), rgba(168,85,247,0.15)) !important;
		  border: 2px solid rgba(56,189,248,0.8) !important;
		  box-shadow: 0 0 20px rgba(56,189,248,0.4) !important;
		  z-index: 1000 !important;
		}
		.auth-locked #licenseForm * { pointer-events: auto !important; opacity: 1 !important; }

		/* Persistent auth-bar - always visible */
		#licenseForm {
		  display: flex !important;
		  background: linear-gradient(135deg, rgba(56,189,248,0.12), rgba(15,23,42,0.95)) !important;
		  border: 1px solid rgba(56,189,248,0.4) !important;
		  margin: 0.4rem 0 0.6rem 0 !important;
		  padding: 0.6rem 0.8rem !important;
		  border-radius: 12px !important;
		  position: relative !important;
		}
		
/* üéØ LICENSE FORM CONTAINER */
#licenseForm {
  display: flex !important;
  flex-direction: column !important;
  align-items: center !important;
  justify-content: center !important;
  gap: 0.6rem !important;
  width: 100% !important;
}

		/* Unlocked pro status glow */
		#unlockedForm .pill {
		  box-shadow: 0 0 12px rgba(34,197,94,0.6) !important;
		}

		.auth-locked #licenseForm *{pointer-events:auto!important}

		.auth-label {
		  font-size: 0.8rem;
		  color: var(--muted);
		}

		.auth-actions {
		  display: flex;
		  align-items: center;
		  justify-content: center;      /* center buttons as a group */
		  gap: 0.4rem;
		  flex-wrap: wrap;
		}

		.auth-link-btn {
		  font-size: 0.78rem;
		  border-radius: 999px;
		  border: 1px solid rgba(148,163,184,0.8);
		  background: rgba(15,23,42,0.96);
		  color: var(--accent);
		  padding: 0.25rem 0.8rem;
		  cursor: pointer;
		  text-decoration: none;
		  display: inline-flex;
		  align-items: center;
		  gap: 0.25rem;
		  white-space: nowrap;
		}

		/* üé® MATCHING FLOATING BUTTONS - FontSize + Reload */
		#fontSizeFloating {
		  position: fixed !important;
		  top: 0.75rem !important;
		  right: 0.75rem !important;
		  z-index: 3000 !important;
		  width: 36px !important;
		  height: 36px !important;
		  display: flex !important;
		  align-items: center !important;
		  justify-content: center !important;
		  font-size: 1rem !important;
		  border-radius: 12px !important;
		  border: 1px solid rgba(56,189,248,0.4) !important;
		  background: linear-gradient(135deg, rgba(56,189,248,0.15), rgba(15,23,42,0.95)) !important;
		  color: #38bdf8 !important;
		  cursor: pointer !important;
		  box-shadow: 0 4px 12px rgba(56,189,248,0.2), 0 2px 4px rgba(0,0,0,0.3) !important;
		  opacity: 1 !important;
		  pointer-events: auto !important;
		  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
		}

		#fontSizeFloating:hover {
		  background: linear-gradient(135deg, rgba(56,189,248,0.3), rgba(168,85,247,0.2)) !important;
		  box-shadow: 0 8px 25px rgba(56,189,248,0.4), 0 0 0 2px rgba(56,189,248,0.3) !important;
		  transform: scale(1.1) !important;
		}

		#fontSizeFloating:active {
		  transform: scale(0.95) !important;
		}

		/* FontSize label perfect match */
		#fontSizeFloating #fontSizeLabel {
		  font-size: 0.95rem !important;
		  font-weight: 600 !important;
		  line-height: 1 !important;
		}

		/* ALWAYS visible - even when locked */
		.auth-locked #fontSizeFloating {
		  opacity: 1 !important;
		  pointer-events: auto !important;
		}

		/* Subtle in PWA */
		@media (display-mode: standalone), (display-mode: minimal-ui) {
		  #fontSizeFloating { opacity: 0.7 !important; }
		  #fontSizeFloating:hover { opacity: 1 !important; }
		}

		.label-inline-row {
		  position: relative;
		}

		#apiKeyMenu {
		  display: none;
		  position: absolute;
		  top: 100%;
		  left: 0;
		  margin-top: 0.5rem;
		  padding: 0.5rem;
		  background: rgba(15,23,42,0.95);
		  border: 1px solid rgba(56,189,248,0.4);
		  border-radius: 9px;
		  z-index: 10;
		}

		#apiKeyMenu ul {
		  margin: 0;
		  padding: 0;
		  list-style: none;
		  font-size: 0.8rem;
		  color: var(--text);
		  display: flex;
		  gap: 0.5rem;
		}

		#pwaReloadBtn {
		  position: fixed !important;
		  top: 3.2rem !important; /* Below fontSizeFloating (top:0.75rem + height) */
		  right: 0.75rem !important;
		  z-index: 3000 !important; /* Above everything */
		  width: 36px !important;
		  height: 36px !important;
		  display: flex !important;
		  align-items: center !important;
		  justify-content: center !important;
		  font-size: 1rem !important;
		  border-radius: 12px !important;
		  border: 1px solid rgba(56,189,248,0.4) !important;
		  background: linear-gradient(135deg, rgba(56,189,248,0.15), rgba(15,23,42,0.95)) !important;
		  color: #38bdf8 !important;
		  cursor: pointer !important;
		  box-shadow: 0 4px 12px rgba(56,189,248,0.2), 0 2px 4px rgba(0,0,0,0.3) !important;
		  opacity: 1 !important;
		  pointer-events: auto !important;
		  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
		}

		#pwaReloadBtn:hover {
		  background: linear-gradient(135deg, rgba(56,189,248,0.3), rgba(168,85,247,0.2)) !important;
		  box-shadow: 0 8px 25px rgba(56,189,248,0.4), 0 0 0 2px rgba(56,189,248,0.3) !important;
		  transform: scale(1.1) rotate(180deg) !important;
		}

		#pwaReloadBtn:active {
		  transform: scale(0.95) !important;
		}

		/* ALWAYS visible - even when locked */
		.auth-locked #pwaReloadBtn,
		#pwaReloadBtn {
		  opacity: 1 !important;
		  pointer-events: auto !important;
		}

		/* Subtle in PWA */
		@media (display-mode: standalone), (display-mode: minimal-ui) {
		  #pwaReloadBtn { opacity: 0.7 !important; }
		  #pwaReloadBtn:hover { opacity: 1 !important; }
		}

		/* ‚ö° INSTANT AUTH-BAR RESIZE */
		#licenseForm.unlocked {
		  flex-wrap: nowrap !important;
		  gap: 0.5rem !important;
		  justify-content: center !important;
		  align-items: center !important;
		  padding: 0.4rem 0.8rem !important;
		  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
		}

		#proStatus {
		  min-width: auto !important;
		  white-space: nowrap !important;
		  font-size: 0.85rem !important;
		}

		#proLogout {
		  font-size: 0.85rem !important;
		  padding: 0.3rem 0.7rem !important;
		  white-space: nowrap !important;
		}

		/* üï∂Ô∏è HIDE PRO ELEMENTS WHEN LOCKED */
		.auth-locked #proStatus,
		.auth-locked #currentLicenseInfo,
		.auth-locked #proLogout,
		#lockedForm #proStatus,
		#lockedForm #currentLicenseInfo,
		#lockedForm #proLogout {
		  display: none !important;
		  visibility: hidden !important;
		  opacity: 0 !important;
		  height: 0 !important;
		  width: 0 !important;
		  padding: 0 !important;
		  margin: 0 !important;
		}

		/* SHOW ONLY WHEN UNLOCKED */
		.unlocked #proStatus,
		.unlocked #currentLicenseInfo,
		.unlocked #proLogout {
		  display: inline-flex !important;
		  visibility: visible !important;
		  opacity: 1 !important;
		}

#lockedForm * { display: block !important; } /* Locked state */
#licenseForm.unlocked #lockedForm,

/* üéØ PERFECT LOCKED CENTER (always) */
#lockedForm {
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  gap: 0.6rem !important;
  flex-wrap: wrap !important;
  width: 100% !important;
  padding: 0.5rem !important;
}

/* LOCKED INPUTS perfect sizing */
.auth-locked #proEmail {
  flex: 1 !important;
  min-width: 160px !important;
  margin-right: 0.5rem !important;
}

.auth-locked #proLicense {
  flex: 1 !important;
  min-width: 120px !important;
  margin-right: 0.5rem !important;
}

.auth-locked #proSignature {
  flex: 2 !important;
  min-width: 280px !important;
}

.auth-locked #proValidate {
  flex-shrink: 0 !important;
  white-space: nowrap !important;
}

/* üéØ HIDE auth-label WHEN UNLOCKED */
#unlockedForm .auth-label,
.auth-unlocked .auth-label,
#licenseForm.unlocked .auth-label {
  display: none !important;
  visibility: hidden !important;
  height: 0 !important;
  width: 0 !important;
  opacity: 0 !important;
}

/* üí• NUCLEAR HIDE lockedForm (MULTI-LAYER) */
#licenseForm.unlocked #lockedForm,
.auth-unlocked #lockedForm,
body:not(.auth-locked) #lockedForm {
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
  height: 0px !important;
  width: 0px !important;
  overflow: hidden !important;
  position: absolute !important;
  left: -9999px !important;
  top: -9999px !important;
  margin: 0 !important;
  padding: 0 !important;
  z-index: -9999 !important;
}

#licenseForm.unlocked #lockedForm *,
body:not(.auth-locked) #lockedForm * {
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
}

/* üîí ONLY SHOW lockedForm when LOCKED */
.auth-locked #lockedForm {
  display: flex !important;
  visibility: visible !important;
  opacity: 1 !important;
  height: auto !important;
  width: 100% !important;
  position: relative !important;
  left: 0 !important;
  top: 0 !important;
}
    </style>
</head>
<body>
<button id="fontSizeFloating" type="button" onclick="toggleFontSizeInline();return false;" aria-label="Toggle text size" style="position:fixed;top:0.75rem;right:0.75rem;z-index:3000;width:36px;height:36px;display:flex;align-items:center;justify-content:center;font-size:1rem;border-radius:12px;border:1px solid rgba(56,189,248,0.4);background:linear-gradient(135deg,rgba(56,189,248,0.15),rgba(15,23,42,0.95));color:#38bdf8;cursor:pointer;box-shadow:0 4px 12px rgba(56,189,248,0.2);transition:all 0.2s ease;">
  <span id="fontSizeLabel">A</span>
</button>
<button id="pwaReloadBtn" type="button" style="position:fixed;top:3.2rem;right:0.75rem;z-index:3000;width:36px;height:36px;display:flex;align-items:center;justify-content:center;font-size:1rem;border-radius:12px;border:1px solid rgba(56,189,248,0.4);background:linear-gradient(135deg,rgba(56,189,248,0.15),rgba(15,23,42,0.95));color:#38bdf8;cursor:pointer;box-shadow:0 4px 12px rgba(56,189,248,0.2);transition:all 0.2s ease;">‚Üª</button>
    <div class="app">
        <header class="app-header">
            <div class="app-title">
                <div class="app-title-main">
				<div class="install-tip-wrap">
				 <div class="install-tip hide-in-pwa">Click 'Install Promptness' in the address bar.</div>
				</div>
                </div>
            </div>
        </header>
        <section class="tabs">

<div class="auth-bar" id="licenseForm" style="z-index:1000;">
	<!-- Locked State - PERFECT CENTER -->
	<div id="lockedForm">
	  <span class="auth-label">üîë Promptness Pro License</span>
	  <input id="proEmail" type="email" placeholder="your@email.com">
	  <input id="proLicense" type="text" placeholder="PRO-XXXXXX">
	  <input id="proSignature" type="text" placeholder="128 hex chars...">
	  <button id="proValidate" class="primary" onclick="validateProInline()">üîì Unlock Pro</button>
	</div>
  
  <!-- Unlocked State - Shows CURRENT license -->
  <div id="unlockedForm" style="display:none; display:flex !important; align-items:center !important; justify-content:center !important; gap:0.4rem !important; width:100% !important; flex-wrap:nowrap !important;">
    <span id="proStatus" class="pill" style="font-weight:600;min-width:160px;background:rgba(34,197,94,0.4)!important;color:#059669!important;box-shadow:0 0 12px rgba(34,197,94,0.6);">‚úÖ PRO Active</span>
    <span id="currentLicenseInfo" style="font-size:0.85rem;color:#38bdf8;background:rgba(56,189,248,0.1);padding:0.3rem 0.6rem;border-radius:8px;border:1px solid rgba(56,189,248,0.3);white-space:nowrap;">Loading...</span>
    <button id="proLogout" class="primary" onclick="proLogoutInline();return false;" 
        style="padding:0.4rem 0.8rem;font-size:0.85rem;background:linear-gradient(135deg,#f87171,#ef4444)!important;color:white!important;border:2px solid rgba(248,113,113,0.8)!important;box-shadow:0 4px 12px rgba(248,113,113,0.3)">Logout</button>
  </div>
</div>

            <div class="tabs-sticky" >
                    <p class="field-desc">Promptly Manages AI Prompts for Text, Image, Video, Audio & Code.</p>
			<div class="pro-bar">
				<div class="label-inline-row api-key-row" style="margin: 0.6rem 0 0.4rem 0;">

						  <div class="label-inline-row">
							<div style="position: relative; display: inline-block;">
							  <label for="apiKey" style="font-size: 0.85rem; font-weight: 600; color: #38bdf8; cursor: pointer;" onclick="toggleApiKeyMenu()">ü§ñ</label>
							  <div id="apiKeyMenu" style="display: none; position: absolute; top: 100%; left: 0; margin-top: 0.35rem; padding: 0.4rem 0.6rem; background: rgba(15,23,42,0.98);
								border: 1px solid rgba(56,189,248,0.6); border-radius: 10px; z-index: 20; max-width: 400px; width: 400px; white-space: normal; box-shadow: 0 8px 18px rgba(15,23,42,0.9);">
								<ul style="margin: 0; padding: 0; list-style: none; font-size: 0.8rem; color: var(--text); display: flex; flex-wrap: wrap; align-items: center; gap: 0.35rem;">
								  <li style="font-weight: 600; color:#38bdf8;">Supported:</li>
								  <li>Perplexity,</li>
								  <li>OpenAI</li>
								</ul>
								<ul style="margin: 0; padding: 0; list-style: none; font-size: 0.8rem; color: var(--text); display: flex; flex-wrap: wrap; align-items: center; gap: 0.35rem;">
								  <li style="font-weight: 600; color:#38bdf8;">Upcoming:</li>
								  <li>HuggingFace,</li>
								  <li>Groq,</li>
								  <li>Custom</li>
								</ul>
								<div style="margin-top: 0.35rem; font-size: 0.78rem; white-space: nowrap;">
								  <a href="https://help.openai.com/en/articles/4936850-where-do-i-find-my-openai-api-key" target="_blank" style="color: white; text-decoration: underline;">Where and how to get AI API keys?</a>
								</div>
							  </div>
							</div>
						  </div>

				  <div style="display: flex; gap: 0.5rem; align-items: center; flex: 1;">
					<input id="apiKey" type="password"
						   placeholder="Enter valid Perplexity or OpenAI API key..."
						   style="flex: 1; background: rgba(15,23,42,0.95); border: 1px solid rgba(56,189,248,0.4); border-radius: 9px; padding: 0.45rem 0.65rem; color: var(--text); font-size: 0.85rem;">
					<div class="pill" id="keyStatus"
						 style="font-size: 0.75rem; padding: 0.25rem 0.6rem; background: rgba(148,163,184,0.2);">Basic mode</div>
			      </div>
				</div>
				<!-- <p class="field-desc">Upcoming supported AI APIs: Perplexity, HuggingFace, Groq, etc...</p> -->
			</div>			
                <nav class="tab-list">
                    <button class="tab-btn tab-btn-active" data-tab="text" style="padding: 7px;>
                        <span class="icon">üìù</span><span>Text</span>
                    </button>
                    <button class="tab-btn" data-tab="image" style="padding: 7px;>
                        <span class="icon">üñºÔ∏è</span><span>Image</span>
                    </button>
                    <button class="tab-btn" data-tab="video" style="padding: 7px;>
                        <span class="icon">üé•</span><span>Video</span>
                    </button>
                    <button class="tab-btn" data-tab="audio" style="padding: 7px;>
                        <span class="icon">üéµ</span><span>Audio</span>
                    </button>
                    <button class="tab-btn" data-tab="code" style="padding: 7px;>
                        <span class="icon">üíª</span><span>Code</span>
                    </button>
					<div class="app-title-actions">					
                    <button id="helpToggle" class="help-link" type="button">
                        <span>?</span>
                    </button>
                </div>
					
                </nav>	
            </div>

            <div class="tab-panels">
                <!-- TEXT TAB -->
                <div class="tab-panel tab-panel-active" data-tab-panel="text">
                    <div class="label-inline-row">
                        <label for="textRole">Expert persona (optional)</label>
                        <p class="field-desc">Who should the AI act as?</p>
                    </div>
                    <input id="textRole" type="text" placeholder="e.g. senior copywriter for ecommerce brands">

                    <div class="label-inline-row">
                        <label for="textGoal">What should the AI write?</label>
                        <p class="field-desc">Describe the main output (article, ad, email, script, etc.).</p>
                    </div>
					
                    <textarea id="textGoal" type="text" placeholder="e.g. a 600-word blog post about beginner calisthenics" style="height: 68px;"></textarea>
                    <!-- <input id="textGoal" type="text" placeholder="e.g. a 600-word blog post about beginner calisthenics"> -->

                    <label for="textAudience">Who is it for? (audience)</label>
					<textarea id="textAudience" type="text" placeholder="e.g. busy professionals with no gym access" style="height: 0px;"></textarea>
                    <!-- <input id="textAudience" type="text" placeholder="e.g. busy professionals with no gym access"> -->

                    <label for="textDetails">Key details / context</label>
                    <textarea id="textDetails" placeholder="Add product details, examples, brand voice notes, links, offers, or constraints." style="height: 68px;"></textarea>


                    <div class="label-inline-row">
                        <label for="textTone">Tone of voice</label>
                    </div>
                    <select id="textTone">
                        <option>Neutral professional</option>
                        <option>Friendly and casual</option>
                        <option>Persuasive and sales-focused</option>
                        <option>Educational and clear</option>
                        <option>Technical and precise</option>
                    </select>
					
                    <label for="textFormat">Preferred structure</label>
                    <select id="textFormat">
                        <option>Short paragraphs with headings</option>
                        <option>Bullet list</option>
                        <option>Step-by-step numbered guide</option>
                        <option>Social media posts (multiple variations)</option>
                        <option>Script format (dialogue + scene directions)</option>
                    </select>

                    <div class="button-row">
                        <span class="hint">Tip: add 1-2 example lines in the context to lock in style.</span>
                        <button class="primary" type="button" id="textGenerate" data-ai-hooked="1">Generate text prompt</button>
                    </div>

                    <div class="output-box">
						<div class="output-label">
						  <span>Text prompt</span>
						  <div style="display: flex; gap: 0.4rem; align-items: center;">
							<span class="pill ai-badge" style="display: none;">
							  ü§ñ AI enhanced
							</span>
							<button class="copy-btn" type="button" data-copy-target="textOutput">
							  Copy
							</button>
							<button class="copy-btn" type="button" id="textOptimizeBtn">
							  Optimize
							</button>
						  </div>
						</div>                        
                        <textarea id="textOutput" class="output-textarea" placeholder="Fill in the fields above and click Generate..." style="height: 120px;" data-ai-tracked="1"></textarea>
                    </div>

                    <div class="collections-box" data-collections-for="text">
                        <div class="collections-actions-row">
                            <input type="text" class="collection-name-input" placeholder="Collection name">
                            <div class="collections-buttons-group">
                                <button class="collections-btn collections-btn-primary save-collection-btn" type="button">Save current</button>
                                <button class="collections-btn export-csv-btn" type="button">Export CSV</button>
                                <label for="import-text" class="collections-btn" style="cursor: pointer; padding: 0.3rem 0.7rem;">Import CSV</label>
                                <input type="file" id="import-text" class="import-input" accept=".csv">
                            </div>
                        </div>
                        <div class="collections-header">
                            <h3>PROMPT COLLECTIONS</h3>
                        </div>
                        <div class="collections-list"><div class="collections-empty">No collections saved for Text yet. Save your first prompt using the controls above.</div></div>
                    </div>
                </div>

                <!-- IMAGE TAB -->
                <div class="tab-panel" data-tab-panel="image">
                    <div class="label-inline-row">
                        <label for="imageSubject">Main subject</label>
                        <p class="field-desc">What should be in the image?</p>
                    </div>
                    <input id="imageSubject" type="text" placeholder="e.g. a small coffee shop on a rainy street at night">

                    <label for="imageDetails">Composition, colors, lighting, mood</label>
                    <textarea id="imageDetails" placeholder="Camera angle, focal length, color palette, lighting, mood, background, level of detail, etc." style="height: 0px;"></textarea>

                    <div class="row">
                        <div>
                            <label for="imageStyle">Style</label>
                            <select id="imageStyle">
                                <option>Realistic photography</option>
                                <option>3D render</option>
                                <option>Watercolor illustration</option>
                                <option>Flat vector art</option>
                                <option>Anime stylized</option>
                            </select>
                        </div>
						<div>
                            <label for="imageTool">Target image model</label>
                            <select id="imageTool">
                                <option>Midjourney</option>
                                <option>DALLE</option>
                                <option>Stable Diffusion</option>
                                <option>Generic text-to-image</option>
                            </select>
                        </div>
                    </div>

                    <label for="imageFormat">Output usage / Use case</label>
                    <select id="imageFormat">
                        <option>Social media post</option>
                        <option>Website hero image</option>
                        <option>Product photo</option>
                        <option>Logo concept</option>
                        <option>Print poster</option>
                    </select>

                    <div class="button-row">
                        <span class="hint">Tip: be very specific about lighting, camera, and style.</span>
                        <button class="primary" type="button" id="imageGenerate" data-ai-hooked="1">Generate image prompt</button>
                    </div>

                    <div class="output-box">
                        <div class="output-label">
						  <span>Image prompt</span>
						  <div style="display: flex; gap: 0.4rem; align-items: center;">
							<span class="pill ai-badge" style="display: none;">
							  ü§ñ AI enhanced
							</span>
							<button class="copy-btn" type="button" data-copy-target="imageOutput">
							  Copy
							</button>
							<button class="copy-btn" type="button" id="imageOptimizeBtn">
							  Optimize
							</button>
						  </div>
						</div>
                        
                        <textarea id="imageOutput" class="output-textarea" placeholder="Fill in the fields above and click Generate..." style="height: 0px;" data-ai-tracked="1"></textarea>
                    </div>

                    <div class="collections-box" data-collections-for="image">
                        <div class="collections-actions-row">
                            <input type="text" class="collection-name-input" placeholder="Collection name">
                            <div class="collections-buttons-group">
                                <button class="collections-btn collections-btn-primary save-collection-btn" type="button">Save current</button>
                                <button class="collections-btn export-csv-btn" type="button">Export CSV</button>
                                <label for="import-image" class="collections-btn" style="cursor: pointer; padding: 0.3rem 0.7rem;">Import CSV</label>
                                <input type="file" id="import-image" class="import-input" accept=".csv">
                            </div>
                        </div>
                        <div class="collections-header">
                            <h3>PROMPT COLLECTIONS</h3>
                        </div>
                        <div class="collections-list"><div class="collections-empty">No collections saved for Image yet. Save your first prompt using the controls above.</div></div>
                    </div>
                </div>

                <!-- VIDEO TAB -->
                <div class="tab-panel" data-tab-panel="video">
                    <div class="row">
						<div>
                            <label for="videoDuration">Duration format</label>
                            <select id="videoDuration">
                                <option>Short (10-30 seconds)</option>
                                <option>Medium (30-90 seconds)</option>
                                <option>Long (2-5 minutes)</option>
                            </select>
                        </div>
						<div>
                            <label for="videoTool">Target video tool</label>
                            <select id="videoTool">
                                <option>Generic text-to-video</option>
                                <option>Synthesia avatar video</option>
                                <option>Runway / Pika style</option>
                                <option>Short-form social video</option>
                            </select>
                        </div>
                    </div>

                    <div class="label-inline-row">
                        <label for="videoConcept">Concept / story</label>
                    </div>
					<textarea id="videoConcept" type="text" placeholder="e.g. promo video introducing a new fitness app" style="height: 0px;"></textarea>
                    <!-- <input id="videoConcept" type="text" placeholder="e.g. promo video introducing a new fitness app"> -->

                    <label for="videoDetails">Scenes, camera, text, voice</label>
                    <textarea id="videoDetails" placeholder="Describe key scenes, camera movement, onscreen text, voiceover style, background music, aspect ratio, etc." style="height: 0px;"></textarea>

                    <label for="videoGoal">Goal</label>
					<textarea id="videoGoal" type="text" placeholder="e.g. drive app downloads, explain how the product works" style="height: 0px;"></textarea>
                    <!-- <input id="videoGoal" type="text" placeholder="e.g. drive app downloads, explain how the product works"> -->

                    <div class="button-row">
                        <span class="hint">Tip: outline 3-5 scenes in your description for better structure.</span>
                        <button class="primary" type="button" id="videoGenerate" data-ai-hooked="1">Generate video prompt</button>
                    </div>

                    <div class="output-box">
						<div class="output-label">
						  <span>Video prompt</span>
						  <div style="display: flex; gap: 0.4rem; align-items: center;">
							<span class="pill ai-badge" style="display: none;">
							  ü§ñ AI enhanced
							</span>
							<button class="copy-btn" type="button" data-copy-target="videoOutput">
							  Copy
							</button>
							<button class="copy-btn" type="button" id="videoOptimizeBtn">
							  Optimize
							</button>
						  </div>
						</div>
                        <textarea id="videoOutput" class="output-textarea" placeholder="Fill in the fields above and click Generate..." style="height: 0px;" data-ai-tracked="1"></textarea>
                    </div>

                    <div class="collections-box" data-collections-for="video">
                        <div class="collections-actions-row">
                            <input type="text" class="collection-name-input" placeholder="Collection name">
                            <div class="collections-buttons-group">
                                <button class="collections-btn collections-btn-primary save-collection-btn" type="button">Save current</button>
                                <button class="collections-btn export-csv-btn" type="button">Export CSV</button>
                                <label for="import-video" class="collections-btn" style="cursor: pointer; padding: 0.3rem 0.7rem;">Import CSV</label>
                                <input type="file" id="import-video" class="import-input" accept=".csv">
                            </div>
                        </div>
                        <div class="collections-header">
                            <h3>PROMPT COLLECTIONS</h3>
                        </div>
                        <div class="collections-list"><div class="collections-empty">No collections saved for Video yet. Save your first prompt using the controls above.</div></div>
                    </div>
                </div>

                <!-- AUDIO TAB -->
                <div class="tab-panel" data-tab-panel="audio">
                    <div class="row">
                        <div>
                            <label for="audioType">Type</label>
                            <select id="audioType">
                                <option>Background music</option>
                                <option>Song idea</option>
                                <option>Sound effects</option>
                                <option>Voiceover narration</option>
                            </select>
                            <label for="audioMood">Mood / genre</label>
                            <input id="audioMood" type="text" placeholder="e.g. chill lofi hip-hop, uplifting pop, dark cinematic">
                        </div>
                    </div>

                    <div>
                        <label for="audioUse">Where will it be used?</label>
                        <input id="audioUse" type="text" placeholder="e.g. YouTube vlog, game menu, podcast intro, TikTok">
                    </div>

                    <label for="audioDetails">Instruments, tempo, structure, voice details</label>
                    <textarea id="audioDetails" placeholder="Mention instruments, tempo (bpm), energy level, sections (intro/verse/chorus), voice gender/accent if needed, etc." style="height: 0px;"></textarea>

                    <div class="button-row">
                        <span class="hint">Tip: describe 2-3 reference artists or songs for closer matches.</span>
                        <button class="primary" type="button" id="audioGenerate" data-ai-hooked="1">Generate audio/music prompt</button>
                    </div>

                    <div class="output-box">
						<div class="output-label">
						  <span>Audio prompt</span>
						  <div style="display: flex; gap: 0.4rem; align-items: center;">
							<span class="pill ai-badge" style="display: none;">
							  ü§ñ AI enhanced
							</span>
							<button class="copy-btn" type="button" data-copy-target="audioOutput">
							  Copy
							</button>
							<button class="copy-btn" type="button" id="audioOptimizeBtn">
							  Optimize
							</button>
						  </div>
						</div>
                        <textarea id="audioOutput" class="output-textarea" placeholder="Fill in the fields above and click Generate..." style="height: 0px;" data-ai-tracked="1"></textarea>
                    </div>

                    <div class="collections-box" data-collections-for="audio">
                        <div class="collections-actions-row">
                            <input type="text" class="collection-name-input" placeholder="Collection name">
                            <div class="collections-buttons-group">
                                <button class="collections-btn collections-btn-primary save-collection-btn" type="button">Save current</button>
                                <button class="collections-btn export-csv-btn" type="button">Export CSV</button>
                                <label for="import-audio" class="collections-btn" style="cursor: pointer; padding: 0.3rem 0.7rem;">Import CSV</label>
                                <input type="file" id="import-audio" class="import-input" accept=".csv">
                            </div>
                        </div>
                        <div class="collections-header">
                            <h3>PROMPT COLLECTIONS</h3>
                        </div>
                        <div class="collections-list"><div class="collections-empty">No collections saved for Audio yet. Save your first prompt using the controls above.</div></div>
                    </div>
                </div>

                <!-- CODE TAB -->
                <div class="tab-panel" data-tab-panel="code">
                    <div class="row">
                        <div>
                            <label for="codeLang">Language / stack</label>
                            <input id="codeLang" type="text" placeholder="e.g. HTML/CSS/JS, Python, Node.js with Express, React">
                            <label for="codeTaskType">Task type</label>
                            <select id="codeTaskType">
                                <option>Generate new code</option>
                                <option>Refactor / clean up code</option>
                                <option>Debug / fix an error</option>
                                <option>Explain code step-by-step</option>
                                <option>Optimize performance</option>
                            </select>
                        </div>
                    </div>

                    <div class="label-inline-row">
                        <label for="codeGoal">What should the code do?</label>
                    </div>
                    <input id="codeGoal" type="text" placeholder="e.g. simple landing page with email signup">

                    <label for="codeContext">Context / current code, error, constraints</label>
                    <textarea id="codeContext" placeholder="Paste relevant code snippets or error messages, describe libraries/frameworks, file structure, environment, etc." style="height: 0px;"></textarea>

                    <label for="codeExtras">Special requirements</label>
					<textarea id="codeExtras" type="text" placeholder="e.g. mobile-first, no external libraries, add comments, follow best practices" style="height: 0px;"></textarea>
                   <!-- <input id="codeExtras" type="text" placeholder="e.g. mobile-first, no external libraries, add comments, follow best practices"> -->

                    <div class="button-row">
                        <span class="hint">Tip: include the smallest reproducible example of your bug.</span>
                        <button class="primary" type="button" id="codeGenerate" data-ai-hooked="1">Generate code prompt</button>
                    </div>

                    <div class="output-box">
						<div class="output-label">
						  <span>Code prompt</span>
						  <div style="display: flex; gap: 0.4rem; align-items: center;">
							<span class="pill ai-badge" style="display: none;">
							  ü§ñ AI enhanced
							</span>
							<button class="copy-btn" type="button" data-copy-target="codeOutput">
							  Copy
							</button>
							<button class="copy-btn" type="button" id="codeOptimizeBtn">
							  Optimize
							</button>
						  </div>
						</div>
                        <textarea id="codeOutput" class="output-textarea" placeholder="Fill in the fields above and click Generate..." style="height: 0px;" data-ai-tracked="1"></textarea>
                    </div>

                    <div class="collections-box" data-collections-for="code">
                        <div class="collections-actions-row">
                            <input type="text" class="collection-name-input" placeholder="Collection name">
                            <div class="collections-buttons-group">
                                <button class="collections-btn collections-btn-primary save-collection-btn" type="button">Save current</button>
                                <button class="collections-btn export-csv-btn" type="button">Export CSV</button>
                                <label for="import-code" class="collections-btn" style="cursor: pointer; padding: 0.3rem 0.7rem;">Import CSV</label>
                                <input type="file" id="import-code" class="import-input" accept=".csv">
                            </div>
                        </div>
                        <div class="collections-header">
                            <h3>PROMPT COLLECTIONS</h3>
                        </div>
                        <div class="collections-list"><div class="collections-empty">No collections saved for Code yet. Save your first prompt using the controls above.</div></div>
                    </div>
                </div>
            </div>
        </section>

        <section style="margin-top: 1.2rem; border-top: 1px solid rgba(148,163,184,0.5); padding-top: 0.7rem; font-size: 0.78rem; color: var(--muted-dark);">
            <h3 style="font-size: 0.9rem; margin: 0 0 0.3rem; color: var(--text);">Collections, CSV compatibility</h3>
            <ul style="margin: 0 0 0.3rem 1.1rem; padding: 0;">
                <li style="margin-bottom: 0.15rem;">Collections are stored in browser localStorage, per tab (Text, Image, Video, Audio, Code).</li>
				<li style="margin-bottom: 0.15rem;">Collections per tab are exported to a single CSV. Import only the exported collections per tab.</li>
                <li style="margin-bottom: 0.15rem;">Export CSV downloads a CSV snapshot for the current tab.</li>
                <li style="margin-bottom: 0.15rem;">Import CSV adds collections from exported CSV files.</li>
                <li style="margin-bottom: 0.15rem;">Files are not synced automatically - you choose where to save your CSVs.</li>
				<li style="margin-bottom: 0.15rem;">For portability, keep backups of your CSV exports in cloud storage.</li>
            </ul>
        </section>
        <div class="footer">Built with HTML, CSS &amp; JS.</div>
    </div>

    <!-- Help Overlay -->
    <div class="help-overlay-backdrop" id="helpBackdrop">
        <div class="help-overlay">
            <div class="help-header">
                <div>
                    <span class="help-tag">Self-help guide</span>
                    <h2>How to...</h2>
                </div>
                <button class="help-close" type="button" id="helpClose">Close</button>
            </div>
            <div class="help-body">
                <p>Promptness lets you generate prompts and manage collections locally, with CSV export/import per tab.</p>

                <h3>Using collections</h3>
                <ul>
                    <li>Pick a tab and generate a prompt into the output box.</li>
                    <li>Enter a collection name and click <strong>Save current</strong> to add it to the list for that tab.</li>
                    <li>Click any saved item or its <strong>Load</strong> button to restore that prompt to the output box.</li>
                    <li>Use the <strong>Rename</strong> and <strong>Delete</strong> buttons on each row to maintain the list.</li>
                    <li>Use <strong>Export CSV</strong> to backup and <strong>Import CSV</strong> to restore collections between browsers/devices.</li>
                </ul>

                <h3>Storage limitations</h3>
                <ul>
                    <li>Collections live in your browser's localStorage and do not auto-sync across devices.</li>
                    <li>CSV files are saved where you choose - you must export/import them manually when needed.</li>
                    <li>This app calls Perplexity and OpenAI API keys - you need to provide your own. If not, it only produces form base prompts that you copy into your tools.</li>
                </ul>
				
				<h3>üö® Troubleshooting</h3>
  <ul>
    <li><strong>Invalid signature?</strong> Copy full 128-char hex from email (starts with 304502...)</li>
    <li><strong>Lost license?</strong> Re-enter once ‚Üí Stays unlocked forever</li>
    <li><strong>Offline API fails?</strong> Normal - OpenAI needs internet. Form base prompts work offline</li>
    <li><strong>Slow first load?</strong> Normal - caches after first visit</li>
    <li><strong>PWA not installing?</strong> Chrome: Address bar icon. Safari: Share ‚Üí Add to Home</li>
  </ul>
  <p><strong>Support Contact:</strong> esv.tnt010@gmail.com</p>
  

	<hr style="border: none; border-top: 1px solid rgba(148,163,184,0.4); margin: 0.75rem 0 0.5rem;">

	<div class="help-section">
	  <h2>Promptness EULA &amp; Terms of Use</h2>
	  <p class="help-tag">LEGAL TERMS</p>

	  <p>
		<strong>Last updated:</strong> [DECEMBER 2025]
	  </p>

	  <p>
		This End User License Agreement and Terms of Use (‚ÄúAgreement‚Äù) is a legal agreement between you
		(‚ÄúUser‚Äù) and <!--[YOUR NAME / COMPANY]--> (‚ÄúProvider‚Äù) governing your use of the <strong>Promptness</strong>
		application, including its Progressive Web App (PWA) and browser-based versions (‚ÄúApp‚Äù). By
		accessing or using the App, you agree to be bound by this Agreement. If you do not agree, do not
		use the App.
	  </p>

	  <h3>1. License Grant</h3>
	  <p>
		Provider grants you a limited, non-exclusive, non-transferable, non-sublicensable license to
		access and use Promptness for your personal or internal business purposes only, subject to this
		Agreement. This license does not transfer any ownership rights in the App or its content.
	  </p>

	  <h3>2. Permitted Use</h3>
	  <p>
		Subject to this Agreement, you may:
	  </p>
	  <ul>
		<li>Access and use Promptness to create, manage, and reuse prompts for text, image, video, audio, code, and other supported formats.</li>
		<li>Store your own prompt content locally (for example in browser storage or CSV exports) for your personal or internal business use.</li>
		<li>Install and use the PWA version of Promptness on your compatible devices.</li>
	  </ul>

	  <h3>3. Prohibited Use</h3>
	  <p>You may not:</p>
	  <ul>
		<li>Copy, distribute, resell, or publicly host the App or any substantial part of its code, design, or user interface, including hosting your own public or paid clone of Promptness.</li>
		<li>Modify, adapt, translate, reverse engineer, decompile, or disassemble any part of the App except where such restrictions are prohibited by applicable law.</li>
		<li>Bypass or attempt to bypass any technical protection measures, license checks, paywalls, or usage limits (including free/paid feature distinctions).</li>
		<li>Use the App to create, generate, or distribute content that is illegal, defamatory, abusive, or infringes the intellectual property, privacy, or other rights of any third party.</li>
		<li>Remove, alter, or obscure any copyright, trademark, or other proprietary notices displayed in or with the App.</li>
		<li>Use automated tools (such as bots or scrapers) to systematically copy or harvest the App‚Äôs interface, assets, or non-user content.</li>
	  </ul>

	  <h3>4. Accounts, Access, and Payment</h3>
	  <p>
		Some features of Promptness may require registration of an account and/or payment of fees. You
		agree to provide accurate information and keep it up to date. Where Promptness is offered as a
		paid product or subscription, access to certain features may be conditional on timely payment.
		Provider may suspend or limit access if payment is overdue or reversed. License keys, access
		tokens, or paid accounts are personal to you and may not be shared, sold, or transferred without
		Provider‚Äôs written consent.
	  </p>

	  <h3>5. Offline Use and Local Storage</h3>
	  <p>
		Promptness may offer offline functionality using local storage and caching technologies. You are
		responsible for managing your own device storage, backups, and security. You must not use offline
		or locally stored copies of the App to circumvent licensing, payment requirements, or other limits
		set by Provider.
	  </p>

	  <h3>6. Intellectual Property</h3>
	  <p>
		Promptness, including its code, design, logos, branding, text, and other non-user content, is
		owned by Provider or its licensors and is protected by copyright, trademark, and other laws. You
		retain all rights in your own prompts and content that you create with the App and are solely
		responsible for that content and for any rights or permissions required to use it.
	  </p>

	  <h3>7. Third-Party Services</h3>
	  <p>
		Promptness may integrate with or link to third-party services (such as payment processors or AI
		providers). Those services are governed by their own terms and privacy policies. Provider is not
		responsible for the availability, security, or content of third-party services.
	  </p>

	  <h3>8. No Warranty</h3>
	  <p>
		The App is provided on an ‚Äúas is‚Äù and ‚Äúas available‚Äù basis, without warranties of any kind,
		whether express or implied, including but not limited to warranties of merchantability, fitness
		for a particular purpose, or non-infringement. Provider does not warrant that the App will be
		error-free, secure, or uninterrupted, or that defects will be corrected.
	  </p>

	  <h3>9. Limitation of Liability</h3>
	  <p>
		To the maximum extent permitted by law, Provider will not be liable for any indirect, incidental,
		consequential, special, or punitive damages, or for any loss of data, revenue, profits, or
		business, arising out of or related to your use of or inability to use the App. Provider‚Äôs total
		aggregate liability for any claims arising out of or related to this Agreement or the App will
		not exceed the amount you actually paid to Provider for access to the App during the twelve (12)
		months prior to the event giving rise to the claim (or, if you did not pay, zero).
	  </p>

	  <h3>10. Termination</h3>
	  <p>
		This Agreement is effective until terminated. Provider may suspend or terminate your access to
		the App at any time if you breach this Agreement or if Provider discontinues the App. Upon
		termination, your license to use the App ends immediately. Sections that by their nature should
		survive (including Intellectual Property, No Warranty, Limitation of Liability) will continue to
		apply.
	  </p>

	  <h3>11. Updates and Changes</h3>
	  <p>
		Provider may modify or update the App and this Agreement from time to time. Updated versions may
		be posted or made available within the App. If you continue to use the App after changes to this
		Agreement take effect, you will be deemed to have accepted the revised terms.
	  </p>

	  <h3>12. Governing Law and Dispute Resolution</h3>
	  <p>
		This Agreement will be governed by and construed in accordance with the laws <!-- of
		[YOUR COUNTRY / STATE] -->, without regard to its conflict of law rules. Any disputes arising out of
		or in connection with this Agreement or the App will be subject to the exclusive jurisdiction of
		the courts <!-- of [YOUR CITY / REGION] -->, unless applicable law requires otherwise.
	  </p>

	  <h3>13. Contact</h3>
	  <p class="field-desc">
		If you have questions about this Agreement or Promptness, contact:
		Promptness Developer ‚Äì esv.tnt010@gmail.com
	  </p>
	  <!--
	  <p class="field-desc">
		This EULA/Terms of Use text is provided as a general template and should be reviewed and adapted
		by a qualified legal professional for your specific situation and jurisdiction.
	  </p> -->
	</div>
            </div>
        </div>
    </div>

    <script>
			// ===== AI BOOSTER (NO EXTERNAL API CALLS) =====
			const BOOSTERS = {
			  text: '\n\nAdd: expert tone, clear structure (intro, key points, conclusion), concise sentences, and remove vague wording or repetition.',
			  image: '\n\nAdd: (masterpiece, best quality:1.3), sharp symmetrical composition, clean background, clear subject separation, and remove clutter or unnecessary elements.',
			  video: '\n\nAdd: three clear scenes (hook, main explanation, closing), smooth transitions, clear on-screen text, and remove redundant or confusing shots.',
			  audio: '\n\nAdd: clear mix, consistent volume, appropriate tempo, simple structure (intro, main part, outro), and remove background noise.',
			  code: '\n\nAdd: clear comments, consistent naming, small functions, input validation, and remove dead or duplicated code.'
			};
			
			// Generic validity: looks like a real secret (long, safe characters)
			function isValidApiKey(key) {
			  // Must start with a letter, be reasonably long, and use safe chars
			  return /^[A-Za-z][A-Za-z0-9_\-]{23,}$/.test(key);
			}

			// Best-effort provider guess based on prefix (for display only)
			function detectProvider(key) {
			  if (!key) return null;

			  if (key.startsWith('pplx-')) return 'Perplexity';     // Perplexity
			  if (key.startsWith('sk-'))   return 'OpenAI';         // OpenAI
			  if (key.startsWith('gsk_') || key.startsWith('gsk-')) return 'Groq';        // Groq examples
			  if (key.startsWith('hf_')  || key.startsWith('hf-'))  return 'HuggingFace'; // HF Hub/API

			  return 'Custom';
			}			

			function hasValidApiKey() {
			  const input = document.getElementById('apiKey');
			  const key = input ? input.value.trim() : '';
			  return isValidApiKey(key);
			}

		// TARGETED FIX - Removes ALL ‚ú® (tab): duplicates
		function stripAllOptimizations(text) {
		  if (!text) return '';
		  return text
			// CRITICAL: Remove ALL ‚ú® (text):, ‚ú® (image): etc. patterns
			.replace(/‚ú®\s*\(\w+\)\s*:/gi, '')
			.replace(/‚ú®\s*\([a-zA-Z]+\)\s*:/gi, '')
			
			// Remove other optimization prefixes
			.replace(/^(‚ú®|üî•|BASIC OPTIMIZED|AI OPTIMIZED).*?:/gmi, '')
			.replace(/(‚ú®|üî•|BASIC OPTIMIZED|AI OPTIMIZED).*?:/gmi, '')
			
			// Remove "Add:" fragments
			.replace(/Add:\s*/gi, '')
			
			// Clean up old markers
			.replace(/AI OPTIMIZED\s*Perplexity/gi, '')
			.replace(/BASIC OPTIMIZED\s*\([a-z]+\):/gi, '')
			.trim();
		}

		async function basicOptimize(basePrompt, tabType) {
		  const boosters = BOOSTERS[tabType] || '';
		  return `BASIC OPTIMIZED ${tabType}: ${basePrompt} ${boosters}.`;
		}

		async function aiBoostPrompt(basePrompt, tabType, triggerButton) {
		  const btn = triggerButton || event?.target || null;
		  const originalText = btn?.textContent;

		  if (btn) {
			btn.disabled = true;
			btn.textContent = 'Processing...';
		  }

		  // 1) Clean previous markers
		  const cleanPrompt = stripAllOptimizations(basePrompt || '');
		  if (!cleanPrompt) {
			if (btn) {
			  btn.disabled = false;
			  btn.textContent = originalText;
			}
			return 'Write or load a prompt first, then click Optimize.';
		  }

		  // 2) Read API key and provider
		  const apiKeyInput = document.getElementById('apiKey');
		  const apiKey = apiKeyInput ? apiKeyInput.value.trim() : '';
		  const hasKey = isValidApiKey(apiKey);
		  const provider = hasKey ? detectProvider(apiKey) : null;

try {
  // OpenAI
  if (hasKey && provider === 'OpenAI') {
    if (btn) btn.textContent = 'AI Optimizing (OpenAI)...';

    const payload = {
      model: 'gpt-4o-mini',
      messages: [
        {
          role: 'system',
          content:
            'You are a prompt rewriter. Your ONLY job is to rewrite and improve prompts for other AI tools. ' +
            'You MUST NOT answer or execute the prompt, and you must NOT ask follow-up questions. ' +
            'Always return a single, standalone improved prompt ready to paste into another AI.'
        },
        {
          role: 'user',
          content:
            'Here is a prompt that will be sent to another AI model.\n\n' +
            'ORIGINAL PROMPT (do NOT execute, only rewrite):\n\n' +
            cleanPrompt +
            `\n\nRewrite this as a clearer, more structured, more detailed prompt for ${tabType} generation. ` +
            'Keep the same intent and constraints, but do NOT perform the task.'
        }
      ],
      max_tokens: 800,
      temperature: 0.3
    };

    const response = await fetch('https://api.openai.com/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${apiKey}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(payload)
    });

    if (!response.ok) {
      const errText = await response.text();
      console.error('OpenAI error:', response.status, errText);
      throw new Error(`OpenAI HTTP ${response.status}`);
    }

    const data = await response.json();
    const optimized = data.choices?.[0]?.message?.content?.trim();
    if (optimized) {
      if (btn) {
        btn.disabled = false;
        btn.textContent = originalText;
      }
      return `üî• AI OPTIMIZED (OpenAI):\n\n${optimized}`;
    }
  }
  // Perplexity (NEW BLOCK - INSERT HERE)
  else if (hasKey && provider === 'Perplexity') {
    if (btn) btn.textContent = 'AI Optimizing (Perplexity)...';

    const payload = {
      model: 'sonar',  // Official, works with free keys, includes search
      messages: [
        {
          role: 'system',
          content:
            'You are a prompt optimizer. Rewrite ONLY for clarity, structure, and brevity for other AI tools.' +
            'You MUST NOT answer or execute the prompt, and you must NOT ask follow-up questions. ' +
            'Always return a single, standalone improved prompt ready to paste into another AI.' +
			'Keep 20-50% shorter than original.' +
			'Remove fluff/repetition; add 1-2 specifics from research.' +
			'Single standalone prompt, no explanations/comments.' +
			'Output format: headings, bullets if needed.'
        },
        {
          role: 'user',
          content:
            'Here is a prompt that will be sent to another AI model.\n\n' +
            'ORIGINAL PROMPT (do NOT execute, only rewrite):\n\n' +
            cleanPrompt +
            `\n\nRewrite this as a clearer, more structured, more detailed prompt for ${tabType} generation. ` +
            'Keep the same intent and constraints, but do NOT perform the task.'
        }
      ],
      max_tokens: 800,
      temperature: 0.3,
      // Perplexity extras for web search
      // search_mode: 'default', // 'default', 'web', 'academic'
      // search_context_size: 'medium' // 'short', 'medium', 'long'
    };

    const response = await fetch('https://api.perplexity.ai/chat/completions', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${apiKey}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(payload)
    });

    if (!response.ok) {
      const errText = await response.text();
      console.error('Perplexity error:', response.status, errText);
      throw new Error(`Perplexity HTTP ${response.status}`);
    }

    const data = await response.json();
    const optimized = data.choices?.[0]?.message?.content?.trim();
    if (optimized) {
      if (btn) {
        btn.disabled = false;
        btn.textContent = originalText;
      }
      return `üî• AI OPTIMIZED (Perplexity):\n\n${optimized}`;
    }
  }
} catch (err) {
  console.error('AI provider failed:', err);
  // Fall through to basic mode
}

		  // 3) BASIC MODE (no key or provider error)
		  if (btn) btn.textContent = 'Basic Optimizing...';
		  const basicEnhanced = `‚ú® BASIC OPTIMIZED (${tabType}):\n\n${cleanPrompt}`;

		  setTimeout(() => {
			if (btn) {
			  btn.disabled = false;
			  btn.textContent = originalText;
			}
		  }, 800);

		  return basicEnhanced;
		}

		// Key status pill
		document.addEventListener('DOMContentLoaded', () => {
		  const apiKeyInput = document.getElementById('apiKey');
		  const status = document.getElementById('keyStatus');
		  if (!apiKeyInput || !status) return;

		  apiKeyInput.addEventListener('input', e => {
			const key = e.target.value.trim();
			if (isValidApiKey(key)) {
			  const provider = detectProvider(key);
			  if (provider === 'OpenAI') {
				status.textContent = 'PRO mode (OpenAI)';
				status.style.background = 'rgba(34,197,94,0.3)';
			  } else if (provider === 'Perplexity') {
				status.textContent = 'PRO mode (Perplexity)';
				status.style.background = 'rgba(34,197,94,0.3)';
			  } else if (provider === 'Groq') {
				status.textContent = 'Upcoming (Groq)';
				status.style.background = 'rgba(148,163,184,0.2)';
			  } else if (provider === 'HuggingFace') {
				status.textContent = 'Upcoming (HuggingFace)';
				status.style.background = 'rgba(148,163,184,0.2)';
			  } else {
				status.textContent = 'Upcoming (Custom)';
				status.style.background = 'rgba(148,163,184,0.2)';
			  }
			} else if (key.length > 0) {
			  status.textContent = 'Invalid key';
			  status.style.background = 'rgba(248,113,113,0.3)';
			} else {
			  status.textContent = 'Basic mode';
			  status.style.background = 'rgba(148,163,184,0.2)';
			}
		  });
	
        // Tab functionality
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabPanels = document.querySelectorAll('.tab-panel');
        const tabNiceNames = { text: 'Text', image: 'Image', video: 'Video', audio: 'Audio', code: 'Code' };
        let currentTab = 'text';

        tabButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const target = btn.getAttribute('data-tab');
                tabButtons.forEach(b => b.classList.remove('tab-btn-active'));
                tabPanels.forEach(p => p.classList.remove('tab-panel-active'));
                btn.classList.add('tab-btn-active');
                const panel = document.querySelector(`[data-tab-panel="${target}"]`);
                if (panel) panel.classList.add('tab-panel-active');
                currentTab = target;
                renderCollections();
            });
        });

		// Copy to clipboard (desktop + mobile friendly)
		document.querySelectorAll('.copy-btn').forEach(btn => {
		  btn.addEventListener('click', async () => {
			const targetId = btn.getAttribute('data-copy-target');
			const field = document.getElementById(targetId);
			if (!field || !field.value.trim()) return;

			const text = field.value;
			let copied = false;

			// 1) Try modern async clipboard API
			if (navigator.clipboard && navigator.clipboard.writeText) {
			  try {
				await navigator.clipboard.writeText(text);
				copied = true;
			  } catch (e) {
				copied = false;
			  }
			}

			// 2) Fallback for mobile/old browsers using a temporary textarea
			if (!copied) {
			  const temp = document.createElement('textarea');
			  temp.value = text;
			  // Keep it off-screen but focusable
			  temp.style.position = 'fixed';
			  temp.style.top = '-9999px';
			  temp.style.left = '-9999px';
			  document.body.appendChild(temp);
			  temp.focus();
			  temp.select();
			  try {
				document.execCommand('copy');
				copied = true;
			  } catch (e) {
				copied = false;
			  }
			  document.body.removeChild(temp);
			}

			// Small UI feedback so users know something happened
			const old = btn.textContent;
			btn.textContent = copied ? 'Copied!' : 'Copy failed';
			setTimeout(() => {
			  btn.textContent = old;
			}, 1200);
		  });
		});

        // Generate handlers
		document.getElementById('textGenerate').addEventListener('click', async (event) => {
		  const role = document.getElementById('textRole').value.trim();
		  const tone = document.getElementById('textTone').value;
		  const goal = document.getElementById('textGoal').value.trim();
		  const audience = document.getElementById('textAudience').value.trim();
		  const details = document.getElementById('textDetails').value.trim();
		  const format = document.getElementById('textFormat').value;
		  const out = document.getElementById('textOutput');

		  if (!goal) {
			out.value = 'Describe what you want the AI to write in the ‚ÄúWhat should the AI write?‚Äù field, then click Generate.';
			autoResizeTextarea(out);
			return;
		  }

		  let base = role ? `You are a ${role}. You are an expert writer.\n` : '';
		  base += `Your task is to write ${goal}`;
		  if (audience) base += ` for the following audience: ${audience}.`;
		  if (details) base += `\n\nContext/Details: ${details}`;
		  base += `\n- Tone of voice: ${tone}.\n- Output format: ${format}.\n- Ask up to 3 clarification questions first if anything is unclear, then produce the final answer.`;

		  const enhanced = await aiBoostPrompt(base, 'text', event.currentTarget);
		  out.value = enhanced;
		  autoResizeTextarea(out);
		});
		
		//Optimize handler text tab
		const textOptimizeBtn = document.getElementById('textOptimizeBtn');
		if (textOptimizeBtn) {
		  textOptimizeBtn.addEventListener('click', async (event) => {
			const out = document.getElementById('textOutput');
			const current = out.value.trim();
			if (!current) {
			  out.value = 'Load or generate a prompt first, then click Optimize.';
			  autoResizeTextarea(out);
			  return;
			}
			const enhanced = await aiBoostPrompt(current, 'text', event.currentTarget);
			out.value = enhanced;
			autoResizeTextarea(out);
		  });
		}

		//Optimize handler image tab
		const imageOptimizeBtn = document.getElementById('imageOptimizeBtn');
		if (imageOptimizeBtn) {
		  imageOptimizeBtn.addEventListener('click', async (event) => {
			const out = document.getElementById('imageOutput');
			const current = out.value.trim();
			if (!current) {
			  out.value = 'Load or generate an image prompt first, then click Optimize.';
			  autoResizeTextarea(out);
			  return;
			}
			const enhanced = await aiBoostPrompt(current, 'image', event.currentTarget);
			out.value = enhanced;
			autoResizeTextarea(out);
		  });
		}

		document.getElementById('imageGenerate').addEventListener('click', async (event) => {
		  const tool = document.getElementById('imageTool').value;
		  const style = document.getElementById('imageStyle').value;
		  const subject = document.getElementById('imageSubject').value.trim();
		  const details = document.getElementById('imageDetails').value.trim();
		  const useCase = document.getElementById('imageFormat').value;
		  const out = document.getElementById('imageOutput');

		  if (!subject) {
			out.value = 'Describe the main subject of the image, then click Generate.';
			autoResizeTextarea(out);
			return;
		  }

		  let prompt = `${subject}`;
		  if (details) prompt += `, ${details}`;
		  prompt += `. ${style}. Target model: ${tool}, Use case: ${useCase}.`;

		  const enhanced = await aiBoostPrompt(prompt, 'image', event.currentTarget);
		  out.value = enhanced;
		  autoResizeTextarea(out);
		});

		document.getElementById('videoGenerate').addEventListener('click', async (event) => {
		  const tool = document.getElementById('videoTool').value;
		  const duration = document.getElementById('videoDuration').value;
		  const concept = document.getElementById('videoConcept').value.trim();
		  const details = document.getElementById('videoDetails').value.trim();
		  const goal = document.getElementById('videoGoal').value.trim();
		  const out = document.getElementById('videoOutput');

		  if (!concept) {
			out.value = 'Describe the main concept or story for the video, then click Generate.';
			autoResizeTextarea(out);
			return;
		  }

		  let base = `Create a ${duration.toLowerCase()} ${tool.toLowerCase()} video with the following concept: ${concept}.`;
		  if (goal) base += ` Goal of the video: ${goal}.`;
		  if (details) base += ` Details about scenes, camera, and audio: ${details}.`;
		  base += ` Break the video into clear scenes and suggest onscreen text and voiceover. Include aspect ratio and any export notes if relevant.`;

		  const enhanced = await aiBoostPrompt(base, 'video', event.currentTarget);
		  out.value = enhanced;
		  autoResizeTextarea(out);
		});

		//Optimize handler video tab
		const videoOptimizeBtn = document.getElementById('videoOptimizeBtn');
		if (videoOptimizeBtn) {
		  videoOptimizeBtn.addEventListener('click', async (event) => {
			const out = document.getElementById('videoOutput');
			const current = out.value.trim();
			if (!current) {
			  out.value = 'Load or generate a video prompt first, then click Optimize.';
			  autoResizeTextarea(out);
			  return;
			}
			const enhanced = await aiBoostPrompt(current, 'video', event.currentTarget);
			out.value = enhanced;
			autoResizeTextarea(out);
		  });
		}

		document.getElementById('audioGenerate').addEventListener('click', async (event) => {
		  const type = document.getElementById('audioType').value;
		  const mood = document.getElementById('audioMood').value.trim();
		  const use = document.getElementById('audioUse').value.trim();
		  const details = document.getElementById('audioDetails').value.trim();
		  const out = document.getElementById('audioOutput');

		  if (!mood && !details) {
			out.value = 'Describe the mood/genre and some details (instruments, tempo, or references), then click Generate.';
			autoResizeTextarea(out);
			return;
		  }

		  let base = `Generate ${type.toLowerCase()}`;
		  if (use) base += ` for ${use}`;
		  if (mood) base += `. Mood/genre: ${mood}`;
		  if (details) base += `. ${details}`;
		  base += `. Provide multiple variations if appropriate and include a short description for each version.`;

		  const enhanced = await aiBoostPrompt(base, 'audio', event.currentTarget);
		  out.value = enhanced;
		  autoResizeTextarea(out);
		});

		//Optimize handler audio tab
		const audioOptimizeBtn = document.getElementById('audioOptimizeBtn');
		if (audioOptimizeBtn) {
		  audioOptimizeBtn.addEventListener('click', async (event) => {
			const out = document.getElementById('audioOutput');
			const current = out.value.trim();
			if (!current) {
			  out.value = 'Load or generate an audio prompt first, then click Optimize.';
			  autoResizeTextarea(out);
			  return;
			}
			const enhanced = await aiBoostPrompt(current, 'audio', event.currentTarget);
			out.value = enhanced;
			autoResizeTextarea(out);
		  });
		}

		//Optimize handler code tab
		const codeOptimizeBtn = document.getElementById('codeOptimizeBtn');
		if (codeOptimizeBtn) {
		  codeOptimizeBtn.addEventListener('click', async (event) => {
			const out = document.getElementById('codeOutput');
			const current = out.value.trim();
			if (!current) {
			  out.value = 'Load or generate a code prompt first, then click Optimize.';
			  autoResizeTextarea(out);
			  return;
			}
			const enhanced = await aiBoostPrompt(current, 'code', event.currentTarget);
			out.value = enhanced;
			autoResizeTextarea(out);
		  });
		}

		document.getElementById('codeGenerate').addEventListener('click', async (event) => {
		  const lang = document.getElementById('codeLang').value.trim();
		  const taskType = document.getElementById('codeTaskType').value;
		  const goal = document.getElementById('codeGoal').value.trim();
		  const context = document.getElementById('codeContext').value.trim();
		  const extras = document.getElementById('codeExtras').value.trim();
		  const out = document.getElementById('codeOutput');

		  if (!goal) {
			out.value = 'Describe what you want the code to do in the ‚ÄúWhat should the code do?‚Äù field, then click Generate.';
			autoResizeTextarea(out);
			return;
		  }

		  let base = `You are an experienced ${lang || ''} software developer.\n`;
		  base += `You're tasked to ${taskType.toLowerCase()} for the following goal: ${goal}.`;
		  if (context) base += `\nCode, errors, environment: ${context}`;
		  if (lang) base += `\n- Use ${lang} where applicable.`;
		  if (extras) base += `\n- Special constraints: ${extras}`;
		  base += `\n- Explain your reasoning step-by-step and comment important parts of the code.`;

		  const enhanced = await aiBoostPrompt(base, 'code', event.currentTarget);
		  out.value = enhanced;
		  autoResizeTextarea(out);
		});

        // Help overlay
        const helpToggle = document.getElementById('helpToggle');
        const helpClose = document.getElementById('helpClose');
        const helpBackdrop = document.getElementById('helpBackdrop');

        function closeHelp() {
            helpBackdrop.classList.remove('active');
        }

        helpToggle.addEventListener('click', () => helpBackdrop.classList.add('active'));
        helpClose.addEventListener('click', closeHelp);
        helpBackdrop.addEventListener('click', e => {
            if (e.target === helpBackdrop) closeHelp();
        });
        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') closeHelp();
        });

        // Collections functionality
        const STORAGE_KEY = 'promptCollectionsv1';

        function loadAllCollections() {
            try {
                const raw = localStorage.getItem(STORAGE_KEY);
                if (!raw) return {};
                return JSON.parse(raw);
            } catch (e) {
                return {};
            }
        }

        function saveAllCollections(all) {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(all));
            } catch (e) {
                // Ignore
            }
        }

        function getTabCollections(tab) {
            const all = loadAllCollections();
            return all[tab] || [];
        }

        function setTabCollections(tab, list) {
            const all = loadAllCollections();
            all[tab] = list;
            saveAllCollections(all);
        }

        function getOutputFieldForTab(tab) {
            switch (tab) {
                case 'text': return document.getElementById('textOutput');
                case 'image': return document.getElementById('imageOutput');
                case 'video': return document.getElementById('videoOutput');
                case 'audio': return document.getElementById('audioOutput');
                case 'code': return document.getElementById('codeOutput');
                default: return null;
            }
        }

        function renderCollections() {
            const allBoxes = document.querySelectorAll('.collections-box');
            const allData = loadAllCollections();

            allBoxes.forEach(box => {
                const tab = box.getAttribute('data-collections-for');
                const listEl = box.querySelector('.collections-list');
                const list = allData[tab] || [];
                listEl.innerHTML = '';

                if (!list.length) {
                    const empty = document.createElement('div');
                    empty.className = 'collections-empty';
                    const nice = tabNiceNames[tab] || tab;
                    empty.textContent = `No collections saved for ${nice} yet. Save your first prompt using the controls above.`;
                    listEl.appendChild(empty);
                    return;
                }

                list.forEach(item => {
                    const row = document.createElement('div');
                    row.className = 'collection-item';
                    row.dataset.id = item.id;

                    const main = document.createElement('div');
                    main.className = 'collection-main';
                    const title = document.createElement('div');
                    title.className = 'collection-title';
                    title.textContent = item.name || 'untitled';
                    const meta = document.createElement('div');
                    meta.className = 'collection-meta';
                    const date = item.updatedAt ? new Date(item.updatedAt) : null;
                    const dateStr = date ? date.toLocaleDateString() : '';
                    meta.textContent = `${item.type} Prompt ${dateStr ? `‚Ä¢ ${dateStr}` : ''}`;

                    main.appendChild(title);
                    main.appendChild(meta);

                    const btns = document.createElement('div');
                    btns.className = 'collection-buttons';

                    const loadBtn = document.createElement('button');
                    loadBtn.type = 'button';
                    loadBtn.className = 'collection-small-btn';
                    loadBtn.textContent = 'Load';
                    loadBtn.addEventListener('click', e => {
                        e.stopPropagation();
                        loadCollection(tab, item.id);
                    });

                    const renameBtn = document.createElement('button');
                    renameBtn.type = 'button';
                    renameBtn.className = 'collection-small-btn';
                    renameBtn.textContent = 'Rename';
                    renameBtn.addEventListener('click', e => {
                        e.stopPropagation();
                        renameCollection(tab, item.id);
                    });

                    const delBtn = document.createElement('button');
                    delBtn.type = 'button';
                    delBtn.className = 'collection-small-btn collection-small-btn-danger';
                    delBtn.textContent = 'Delete';
                    delBtn.addEventListener('click', e => {
                        e.stopPropagation();
                        deleteCollection(tab, item.id);
                    });

                    btns.appendChild(loadBtn);
                    btns.appendChild(renameBtn);
                    btns.appendChild(delBtn);

                    row.appendChild(main);
                    row.appendChild(btns);

                    row.addEventListener('click', () => loadCollection(tab, item.id));
                    listEl.appendChild(row);
                });
            });
        }

        function saveCollectionFromBox(box) {
            const tab = box.getAttribute('data-collections-for');
            const nameInput = box.querySelector('.collection-name-input');
            const outputField = getOutputFieldForTab(tab);
            if (!outputField || !outputField.value.trim()) {
                alert('There is no prompt in the output area to save.');
                return;
            }
            const name = nameInput.value.trim() || 'Untitled prompt';
            const list = getTabCollections(tab);
            const now = Date.now();
            const id = 'c' + now + Math.random().toString(16).slice(2);
            const entry = {
                id, name, type: tab, prompt: outputField.value,
                createdAt: now, updatedAt: now
            };
            list.push(entry);
            setTabCollections(tab, list);
            nameInput.value = '';
            renderCollections();
        }

        function loadCollection(tab, id) {
            const list = getTabCollections(tab);
            const found = list.find(x => x.id === id);
            if (!found) return;
            const outputField = getOutputFieldForTab(tab);
            if (!outputField) return;
            outputField.value = found.prompt;
			autoResizeTextarea(outputField);
        }

        function renameCollection(tab, id) {
            const list = getTabCollections(tab);
            const found = list.find(x => x.id === id);
            if (!found) {
                alert('Collection not found.');
                return;
            }
            const newName = prompt('New name for this collection:', found.name);
            if (newName === null) return;
            const trimmed = newName.trim();
            if (!trimmed) return;
            found.name = trimmed;
            found.updatedAt = Date.now();
            setTabCollections(tab, list);
            renderCollections();
        }

        function deleteCollection(tab, id) {
            const list = getTabCollections(tab);
            const found = list.find(x => x.id === id);
            if (!found) {
                alert('Collection not found.');
                return;
            }
            if (!confirm('Delete this collection?')) return;
            const updated = list.filter(x => x.id !== id);
            setTabCollections(tab, updated);
            renderCollections();
        }

		function collectionsToCsv(list) {
			const escapeField = (value) => {
				if (value === null || value === undefined) return '';
				const str = String(value);
				if (str.includes('\n') || str.includes(',') || str.includes('"')) {
					// Properly quote multiline/complex fields
					return '"' + str.replace(/"/g, '""') + '"';
				}
				return str;
			};
			
			const header = 'id,name,type,prompt';
			const lines = [header];
			list.forEach(item => {
				lines.push(`${escapeField(item.id)},${escapeField(item.name)},${escapeField(item.type)},${escapeField(item.prompt)}`);
			});
			return lines.join('\n');
		}

		function parseCSVFull(csvText) {
			const result = [];
			let currentRow = [];
			let currentField = '';
			let inQuotes = false;
			let i = 0;

			while (i < csvText.length) {
				const char = csvText[i];
				
				if (char === '"') {
					// Handle escaped quotes ""
					if (inQuotes && i + 1 < csvText.length && csvText[i + 1] === '"') {
						currentField += '"';
						i++; // Skip next "
					} else {
						inQuotes = !inQuotes;
					}
				} 
				else if (char === ',' && !inQuotes) {
					currentRow.push(currentField);
					currentField = '';
				} 
				else if (char === '\n' && !inQuotes) {
					currentRow.push(currentField);
					result.push(currentRow);
					currentRow = [];
					currentField = '';
				} 
				else {
					currentField += char;
				}
				i++;
			}
			
			// Add final row
			if (currentField || currentRow.length) {
				currentRow.push(currentField);
				result.push(currentRow);
			}
			
			// Clean fields
			return result.map(row => 
				row.map(field => {
					field = field.trim();
					if (field.startsWith('"') && field.endsWith('"')) {
						field = field.slice(1, -1);
					}
					return field.replace(/""/g, '"');
				})
			);
		}

		function csvToCollections(csvText) {
			const parsed = parseCSVFull(csvText);
			if (parsed.length < 2) return [];
			
			const items = [];
			for (let i = 1; i < parsed.length; i++) {
				const row = parsed[i];
				if (row.length >= 4) {
					const [id, name, type, prompt] = row;
					items.push({
						id: id?.trim() || `import_${Date.now()}_${i}`,
						name: name?.trim() || 'Imported',
						type: type?.trim() || 'text',
						prompt: prompt || '',
						createdAt: Date.now(),
						updatedAt: Date.now()
					});
				}
			}
			return items;
		}

		function downloadCsv(filename, csvText) {
			const blob = new Blob([csvText], { type: 'text/csv;charset=utf-8' });
			const url = URL.createObjectURL(blob);
			const a = document.createElement('a');
			a.href = url;
			a.download = filename;
			document.body.appendChild(a);
			a.click();
			document.body.removeChild(a);
			URL.revokeObjectURL(url);
		}

		function exportCsvFromBox(box) {
			const tab = box.getAttribute('data-collections-for');
			const list = getTabCollections(tab);
			if (!list.length) {
				alert('No collections to export for this tab.');
				return;
			}
			const csv = collectionsToCsv(list);
			const filename = `${tab}-prompts.csv`;
			downloadCsv(filename, csv);
		}

		function importCsvFromFile(file, tab) {
			const reader = new FileReader();
			reader.onload = function(e) {
				try {
					const csvText = e.target.result;
					const newItems = csvToCollections(csvText);

					if (newItems.length === 0) {
						alert('No valid collections found in the CSV file.');
						return;
					}

					const currentList = getTabCollections(tab);
					const updatedList = [...currentList];
					let newCount = 0;

					newItems.forEach(newItem => {
						if (!updatedList.find(item => item.id === newItem.id)) {
							updatedList.push(newItem);
							newCount++;
						}
					});

					setTabCollections(tab, updatedList);
					renderCollections();
					alert(`Imported ${newItems.length} collections (${newCount} new).`);
				} catch (err) {
					alert('Error parsing CSV file. Please check the file format.');
				}
			};
			reader.readAsText(file, 'utf-8');
		}

        // Event listeners for collections
        document.querySelectorAll('.collections-box').forEach(box => {
            const saveBtn = box.querySelector('.save-collection-btn');
            const exportBtn = box.querySelector('.export-csv-btn');
            const importLabel = box.querySelector('label[for^="import-"]');
            const importInput = box.querySelector('.import-input');

            saveBtn.addEventListener('click', () => saveCollectionFromBox(box));
            exportBtn.addEventListener('click', () => exportCsvFromBox(box));

            importInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const tab = box.getAttribute('data-collections-for');
                    importCsvFromFile(file, tab);
                    e.target.value = ''; // Reset input
                }
            });
        });

        // Initial render
        renderCollections();
    
		// Auto-resize all textareas as user types
		function autoResizeTextarea(el) {
		  el.style.height = 'auto';
		  el.style.height = el.scrollHeight + 'px';
		}

		document.querySelectorAll('textarea').forEach(el => {
		  // Size correctly for any prefilled content
		  autoResizeTextarea(el);
		  // Grow/shrink with input
		  el.addEventListener('input', () => autoResizeTextarea(el));
		});
	});

	<!-- Refresh -->
	document.addEventListener('DOMContentLoaded', () => {
	  const btn = document.getElementById('pwaReloadBtn');
	  if (!btn) return;

	  btn.addEventListener('click', async () => {
		console.log('Refresh button clicked'); // debug

		if ('serviceWorker' in navigator) {
		  try {
			const reg = await navigator.serviceWorker.getRegistration();
			if (reg) {
			  console.log('Requesting SW update...');
			  await reg.update();
			}
		  } catch (e) {
			console.warn('SW update failed', e);
		  }
		}

		window.location.reload();
	  });
	});
	</script>
	<script type="text/JavaScript">
		if('serviceWorker' in navigator){
			navigator.serviceWorker.register('/service-worker.js')
			.then (()=>console.log("Service worker registered"))
			.catch((error)=>console.log("Service worker failed",error));
		}
	</script>
	<script>
// ‚ö° INSTANT FONT SIZE TOGGLE (no delay)
let fontSizeEnlarged = localStorage.getItem('promptness-font-size') === 'large';

function toggleFontSizeInline() {
  fontSizeEnlarged = !fontSizeEnlarged;
  const html = document.documentElement;
  const label = document.getElementById('fontSizeLabel');
  
  // INSTANT apply
  html.style.fontSize = fontSizeEnlarged ? '20px' : '16px';
  label.textContent = fontSizeEnlarged ? 'a' : 'A';
  
  // Save instantly
  localStorage.setItem('promptness-font-size', fontSizeEnlarged ? 'large' : 'normal');
  
  console.log('üìù Font size:', fontSizeEnlarged ? 'LARGE' : 'NORMAL');
}

// üî• INIT ON LOAD (0ms delay)
(function() {
  if (fontSizeEnlarged) {
    document.documentElement.style.fontSize = '20px';
    document.getElementById('fontSizeLabel').textContent = 'a';
  }
})();
	  
		function toggleApiKeyMenu() {
		  const menu = document.getElementById('apiKeyMenu');
		  menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
		}
	</script>

<script>
document.addEventListener('DOMContentLoaded', async () => {
  console.log('üöÄ Promptness Pro loaded');
  
  // Auto-unlock if valid
  if (localStorage.getItem('promptness-pro-unlocked') === 'true') {
    const savedEmail = localStorage.getItem('promptness-pro-email') || 'user@example.com';
    unlockApp(savedEmail);
  } else {
    // Lock initially
    document.body.classList.add('auth-locked');
  }
  
  // Focus email input
  setTimeout(() => {
    document.getElementById('proEmail').focus();
  }, 100);
});

// üî• BULLETPROOF PRO LICENSE SYSTEM
let currentProEmail = '';
let currentProLicense = '';

function proLogoutInline() {
  if (!confirm('Logout Promptness Pro?\n\nCollections stay saved.\nRe-enter license anytime.')) return;
  
  // üî• STEP 1: HIDE UNLOCKED
  document.getElementById('unlockedForm').style.display = 'none !important';
  document.getElementById('proStatus').style.display = 'none !important';
  document.getElementById('currentLicenseInfo').style.display = 'none !important';
  document.getElementById('proLogout').style.display = 'none !important';
  
// üî• STEP 2: REVERSE NUCLEAR HIDE ‚Üí SHOW lockedForm
const lockedForm = document.getElementById('lockedForm');
lockedForm.style.display = 'flex !important';
lockedForm.style.visibility = 'visible !important';
lockedForm.style.opacity = '1 !important';
lockedForm.style.height = 'auto !important';
lockedForm.style.width = '100% !important';
lockedForm.style.overflow = 'visible !important';
lockedForm.style.position = 'relative !important';
lockedForm.style.left = '0 !important';
lockedForm.style.top = '0 !important';

// üî• RESTORE ALL CHILDREN
lockedForm.querySelectorAll('*').forEach(el => {
  el.style.display = '';
  el.style.visibility = 'visible';
  el.style.opacity = '1';
});
  
  // üî• STEP 3: PERFECT LOCKED LAYOUT
  lockedForm.style.alignItems = 'center !important';
  lockedForm.style.justifyContent = 'center !important';
  lockedForm.style.gap = '0.6rem !important';
  lockedForm.style.flexWrap = 'wrap !important';
  lockedForm.style.width = '100% !important';
  
  // üî• STEP 4: INPUT FLEX RATIOS
  document.getElementById('proEmail').style.flex = '1';
  document.getElementById('proLicense').style.flex = '1';
  document.getElementById('proSignature').style.flex = '2';
  
  // üî• STEP 5: LOCK APP
  document.body.classList.add('auth-locked');
  document.getElementById('licenseForm').classList.remove('unlocked');
  
  // üî• STEP 6: CLEAR FIELDS
  document.getElementById('proEmail').value = '';
  document.getElementById('proLicense').value = '';
  document.getElementById('proSignature').value = '';
  localStorage.removeItem('promptness-pro-unlocked');
  
  // üî• STEP 7: KEYBOARD LOCK
  document.querySelectorAll('button:not(#proValidate):not(#proEmail):not(#proLicense):not(#proSignature), input:not(#proEmail):not(#proLicense):not(#proSignature), textarea, select, .tab-btn').forEach(el => {
    el.tabIndex = -1;
    el.style.pointerEvents = 'none';
  });
  
  // üî• STEP 8: QUAD REFLOW (perfect center)
  requestAnimationFrame(() => {
    lockedForm.offsetHeight;
    document.getElementById('licenseForm').offsetHeight;
    requestAnimationFrame(() => {
      lockedForm.offsetHeight;
      document.getElementById('licenseForm').offsetHeight;
    });
  });
  
  // üî• STEP 9: FOCUS EMAIL
  setTimeout(() => document.getElementById('proEmail').focus(), 100);
  
  console.log('üîí LOGOUT COMPLETE - lockedForm VISIBLE + CENTERED');
}

function validateProInline() {
  console.log('üîì UNLOCK - NUCLEAR HIDE lockedForm');
  const email = document.getElementById('proEmail').value.trim();
  const license = document.getElementById('proLicense').value.trim();
  const sig = document.getElementById('proSignature').value.trim();
  
  if (!email || !license || !sig) {
    alert('Fill all 3 fields: Email, License, Signature');
    return;
  }
  
  if (sig.length !== 128 || !/^[a-f0-9]{128}$/i.test(sig)) {
    alert('Signature must be exactly 128 hex chars (0-9,a-f)');
    return;
  }
  
  // üî• SAVE
  currentProEmail = email;
  currentProLicense = license;
  localStorage.setItem('promptness-pro-unlocked', 'true');
  localStorage.setItem('promptness-pro-email', email);
  localStorage.setItem('promptness-pro-license', license);
  
  // üí• NUCLEAR HIDE lockedForm (MULTI-LAYER)
  const lockedForm = document.getElementById('lockedForm');
  lockedForm.style.display = 'none !important';
  lockedForm.style.visibility = 'hidden !important';
  lockedForm.style.opacity = '0 !important';
  lockedForm.style.height = '0px !important';
  lockedForm.style.width = '0px !important';
  lockedForm.style.overflow = 'hidden !important';
  lockedForm.style.position = 'absolute !important';
  lockedForm.style.left = '-9999px !important';
  
  // üí• HIDE ALL CHILDREN (bulletproof)
  lockedForm.querySelectorAll('*').forEach(el => {
    el.style.display = 'none !important';
    el.style.visibility = 'hidden !important';
    el.style.opacity = '0 !important';
  });
  
  // üî• SHOW ONLY UNLOCKED (CLEAN)
  const unlockedForm = document.getElementById('unlockedForm');
  unlockedForm.style.display = 'flex !important';
  unlockedForm.style.visibility = 'visible !important';
  unlockedForm.style.opacity = '1 !important';
  
  document.getElementById('proStatus').style.display = 'inline-flex !important';
  document.getElementById('currentLicenseInfo').style.display = 'inline-flex !important';
  document.getElementById('proLogout').style.display = 'inline-flex !important';
  
  // üî• CONTENT
  document.getElementById('currentLicenseInfo').textContent = `${email.slice(0,12)}... ${license}`;
  document.getElementById('proStatus').textContent = 'PRO Active';
  
  // üî• UNLOCK
  document.body.classList.remove('auth-locked');
  document.getElementById('licenseForm').classList.add('unlocked');
  
  // üî• KEYBOARD FULL ACCESS
  document.querySelectorAll('button, input, textarea, select').forEach(el => {
    el.tabIndex = 0;
    el.style.pointerEvents = 'auto';
  });
  
  console.log('‚úÖ PRO UNLOCKED - lockedForm NUCLEAR HIDDEN');
}

function unlockApp(email) {
  currentProEmail = email;
  document.body.classList.remove('auth-locked');
  document.getElementById('lockedForm').style.display = 'none';
  document.getElementById('unlockedForm').style.display = 'flex';
  document.getElementById('currentLicenseInfo').textContent = `${email.slice(0,12)}... | ${document.getElementById('proLicense').value.trim()}`;
  localStorage.setItem('promptness-pro-unlocked', 'true');
}

// üîÑ FLOATING RELOAD BUTTON (below fontSize)
document.addEventListener('DOMContentLoaded', () => {
  const reloadBtn = document.getElementById('pwaReloadBtn');
  if (reloadBtn) {
    reloadBtn.title = 'üîÑ Reload Promptness Pro (‚åò+R)\nCollections & Pro status persist';
    reloadBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      e.preventDefault();
      console.log('üîÑ Floating reload clicked');
      if (confirm('üîÑ Reload Promptness Pro?\n\n‚úì Collections saved\n‚úì Pro license persists\n‚úì localStorage intact')) {
        window.location.reload();
      }
    });
  }
});

// üî• STEP 7: FORCE PERFECT LOCKED CENTER (QUADRUPLE reflow)
const lockedForm = document.getElementById('lockedForm');
const licenseForm = document.getElementById('licenseForm');

// FORCE lockedForm properties
lockedForm.style.display = 'flex !important';
lockedForm.style.alignItems = 'center !important';
lockedForm.style.justifyContent = 'center !important';
lockedForm.style.gap = '0.6rem !important';
lockedForm.style.flexWrap = 'wrap !important';
lockedForm.style.width = '100% !important';

// FORCE input flex ratios
document.getElementById('proEmail').style.flex = '1 !important';
document.getElementById('proLicense').style.flex = '1 !important';
document.getElementById('proSignature').style.flex = '2 !important';

// QUAD REFLOW (bulletproof)
requestAnimationFrame(() => {
  licenseForm.offsetHeight;      // 1
  lockedForm.offsetHeight;       // 2
  requestAnimationFrame(() => {
    licenseForm.offsetHeight;    // 3
    lockedForm.offsetHeight;     // 4 ‚úÖ
  });
});

// ‚õî KEYBOARD LOCK (blocks Tab, Enter, Space behind license form)
document.addEventListener('keydown', (e) => {
  if (document.body.classList.contains('auth-locked')) {
    // ALLOW license form navigation
    const licenseForm = document.getElementById('licenseForm');
    const target = e.target.closest('#licenseForm');
    
    if (!target) {
      // BLOCK EVERYTHING ELSE
      if (e.key === 'Tab' || e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        e.stopPropagation();
        return false;
      }
      
      // TRAP focus to license form
      e.preventDefault();
      document.getElementById('proEmail').focus();
      return false;
    }
  }
});

// FOCUS TRAP for license form only
document.addEventListener('focusin', (e) => {
  if (document.body.classList.contains('auth-locked')) {
    const licenseForm = document.getElementById('licenseForm');
    if (!e.target.closest('#licenseForm')) {
      e.preventDefault();
      document.getElementById('proEmail').focus();
    }
  }
});

// üîÑ AUTO RESIZE OBSERVER for currentLicenseInfo
function setupLicenseResizeObserver() {
  const currentLicenseInfo = document.getElementById('currentLicenseInfo');
  if (!currentLicenseInfo) return;
  
  const resizeObserver = new ResizeObserver(() => {
    const licenseForm = document.getElementById('licenseForm');
    if (licenseForm && licenseForm.classList.contains('unlocked')) {
      licenseForm.style.width = 'auto';
      licenseForm.offsetHeight; // Trigger reflow
    }
  });
  
  resizeObserver.observe(currentLicenseInfo);
}

// Init on load
document.addEventListener('DOMContentLoaded', setupLicenseResizeObserver);

</script>
</body>
</html>
